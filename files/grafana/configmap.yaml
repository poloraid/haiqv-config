apiVersion: v1
kind: ConfigMap
metadata:
  name: haiqv-grafana-datasources
  namespace: monitoring
data:
  prometheus.json: |-
    {
      "orgId": 2,
      "access": "proxy",
      "basicAuth": false,
      "editable": false,
      "name": "Prometheus",
      "type": "prometheus",
      "url": "kube-prometheus-stack-prometheus:9090",
      "user": "",
      "password": "",
      "database": "",
      "isDefault": true,
      "jsonData": {"httpMethod": "POST"}
    }
  postgres.json: |-
    {
      "orgId": 2,
      "access": "proxy",
      "basicAuth": false,
      "editable": false,
      "name": "PostgreSQL",
      "type": "postgres",
      "url": "postgresql.utils:5432",
      "user": "postgres",
      "password": "postgresql_1123",
      "database": "dex",
      "isDefault": false,
      "jsonData": {"sslmode": "disable"}
    }
  elasticsearch.json: |-
    {
      "orgId": 2,
      "access": "proxy",
      "basicAuth": false,
      "editable": false,
      "name": "Elasticsearch",
      "type": "elasticsearch",
      "url": "elasticsearch-master.logging:9200",
      "user": "",
      "password": "",
      "database": "*",
      "isDefault": false,
      "jsonData": {"esVersion": 70, "maxConcurrentShardRequests": 5, "timeField": "@timestamp"}
    }
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: haiqv-grafana-dashboards
  namespace: monitoring
data:
  cluster.json: |-
    {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":false,"gnetId":null,"graphTooltip":0,"id":213,"iteration":1678081608774,"links":[],"panels":[{"datasource":null,"fieldConfig":{"defaults":{},"overrides":[]},"gridPos":{"h":1,"w":5,"x":0,"y":0},"id":76,"options":{"activeTheme":"Embed","disableThemePicker":true,"themes":[{"name":"Embed","styles":[{"props":{"theme":"light"},"type":"basetheme"},{"props":{"url":""},"type":"bgimage"},{"props":{"url":""},"type":"url"},{"props":{"text":".panel-container {\n  background-color: #FFFFFF;\n}\n.dashboard-container {\n  background-color: #FFFFFF; \n}\n.navbar {\n  background-color: #FFFFFF;\n}\n.sidemenu {\n  box-shadow: none;\n  -webkit-box-shadow: none;\n}\ndiv.panel-header.grid-drag-handle {\n  pointer-events: none;\n}\ndiv.css-1bpq4j8 {\n  display: none;\n  pointer-events: none;\n}\ndiv.panel-title > div.css-1vzus6i-Icon {\n  display: none;\n  pointer-events: none;\n}\ndiv#panel-76 {\n  visibility: hidden;\n}\ndiv.css-kzwnou-filterWrapper.cell-filter-actions  {\n  display: none !important;\n  pointer-events: none !important;\n}\ndiv#panel-116, div#panel-117, div#panel-118, div#panel-119, div#panel-121, div#panel-122, div#panel-123, div#panel-124 {\n  pointer-events: none;\n}"},"type":"style"},{"props":{"color":""},"type":"panel-container-bg-color"}]}]},"pluginVersion":"0.2.1","timeFrom":null,"timeShift":null,"type":"yesoreyeram-boomtheme-panel"},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":1},"id":8,"panels":[],"title":"Node Summary [ Node : $node ]","type":"row"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":0,"y":2},"id":116,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"(sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{node=~\"$node\", container=~\".+\"})\n OR clamp_max(absent(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{node=~\"$node\", container=~\".+\"}),0)) / sum(kube_node_status_allocatable{job=\"gpu-metrics\", node=~\"$node\", resource=\"cpu\"}) * 100","hide":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"CPU Usage (by Node)","type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":3,"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":6,"y":2},"id":117,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"(count(DCGM_FI_DEV_GPU_UTIL{kubernetes_node=~\"$node\"} > 0) OR clamp_max(absent(DCGM_FI_DEV_GPU_UTIL{kubernetes_node=~\"$node\"} > 0), 0)) / sum(kube_node_status_allocatable{job=\"gpu-metrics\", node=~\"$node\", resource=\"nvidia_com_gpu\"}) * 100","hide":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"GPU Usage (by Node)","type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":12,"y":2},"id":118,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"(sum(container_memory_working_set_bytes{node=~\"$node\", service=\"kube-prometheus-stack-kubelet\"})\n OR clamp_max(absent(container_memory_working_set_bytes{node=~\"$node\", service=\"kube-prometheus-stack-kubelet\"}),0)) / sum(kube_node_status_allocatable{job=\"gpu-metrics\", node=~\"$node\", resource=\"memory\"}) * 100","hide":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Memory Usage (by Node)","type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":18,"y":2},"id":119,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(longhorn_node_storage_usage_bytes{node=~\"$node\"}) / sum(kube_node_status_capacity{job=\"gpu-metrics\", node=~\"$node\", resource=\"ephemeral_storage\"}) * 100","hide":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Storage Usage (by Node)","type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(255, 255, 255)","mode":"fixed"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"core"},"overrides":[{"matcher":{"id":"byName","options":"Available"},"properties":[{"id":"color"}]}]},"gridPos":{"h":4,"w":6,"x":0,"y":5},"id":10,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"titleSize":15,"valueSize":16},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(kube_node_status_allocatable{job=\"gpu-metrics\", node=~\"$node\", resource=\"cpu\"}) OR clamp_max(absent(kube_node_status_allocatable{job=\"gpu-metrics\", node=~\"$node\", resource=\"cpu\"}), 0)","hide":false,"instant":false,"interval":"","legendFormat":"Allocatable","refId":"A"},{"exemplar":true,"expr":"(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\",node=~\"$node\", resource=\"cpu\"}) OR clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\",node=~\"$node\", resource=\"cpu\"}),0))","hide":false,"interval":"","legendFormat":"Requests","refId":"B"},{"exemplar":true,"expr":"(sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{node=~\"$node\", container=~\".+\"})\n OR clamp_max(absent(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{node=~\"$node\", container=~\".+\"}),0))","hide":false,"interval":"","legendFormat":"Used","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"CPU Quota (by Node)","transformations":[{"id":"calculateField","options":{"alias":"Available","binary":{"left":"Capacity","operator":"-","reducer":"sum","right":"Requests"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"organize","options":{"excludeByName":{"Available":true},"indexByName":{"Allocatable":1,"Requests":2,"Time":0,"Used":3},"renameByName":{}}}],"type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(255, 255, 255)","mode":"fixed"},"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"unit"},"overrides":[{"matcher":{"id":"byName","options":"Available"},"properties":[{"id":"color"}]}]},"gridPos":{"h":4,"w":6,"x":6,"y":5},"id":14,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"titleSize":15,"valueSize":16},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"(sum(kube_node_status_allocatable{job=\"gpu-metrics\", node=~\"$node\", resource=\"nvidia_com_gpu\"}) OR clamp_max(absent(kube_node_status_allocatable{job=\"gpu-metrics\", node=~\"$node\", resource=\"nvidia_com_gpu\"}),0))","instant":false,"interval":"","legendFormat":"Allocatable","refId":"A"},{"exemplar":true,"expr":"(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", node=~\"$node\", resource=\"nvidia_com_gpu\"}) OR clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", node=~\"$node\", resource=\"nvidia_com_gpu\"}),0))","hide":false,"interval":"","legendFormat":"Requests","refId":"B"},{"exemplar":true,"expr":"count(DCGM_FI_DEV_GPU_UTIL{kubernetes_node=~\"$node\"} > 0) OR clamp_max(absent(DCGM_FI_DEV_GPU_UTIL{kubernetes_node=~\"$node\"} > 0), 0)","hide":false,"interval":"","legendFormat":"Used","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"GPU Quota (by Node)","transformations":[{"id":"calculateField","options":{"alias":"Available","binary":{"left":"Capacity","operator":"-","reducer":"sum","right":"Requests"},"mode":"binary","reduce":{"reducer":"sum"},"replaceFields":false}},{"id":"organize","options":{"excludeByName":{"Available":true},"indexByName":{"Allocatable":1,"Requests":2,"Time":0,"Used":3},"renameByName":{}}}],"type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(255, 255, 255)","mode":"fixed"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"bytes"},"overrides":[{"matcher":{"id":"byName","options":"Available"},"properties":[{"id":"color"}]}]},"gridPos":{"h":4,"w":6,"x":12,"y":5},"id":18,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"titleSize":15,"valueSize":16},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(kube_node_status_allocatable{job=\"gpu-metrics\", node=~\"$node\", resource=\"memory\"}) OR clamp_max(absent(kube_node_status_allocatable{job=\"gpu-metrics\", node=~\"$node\", resource=\"memory\"}), 0)","instant":false,"interval":"","legendFormat":"Allocatable","refId":"A"},{"exemplar":true,"expr":"(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\",node=~\"$node\", resource=\"memory\"}) OR clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\",node=~\"$node\", resource=\"memory\"}),0))","hide":false,"interval":"","legendFormat":"Requests","refId":"B"},{"exemplar":true,"expr":"(sum(container_memory_working_set_bytes{node=~\"$node\", service=\"kube-prometheus-stack-kubelet\"})\n OR clamp_max(absent(container_memory_working_set_bytes{node=~\"$node\", service=\"kube-prometheus-stack-kubelet\"}),0))","hide":false,"interval":"","legendFormat":"Used","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"Memory Quota (by Node)","transformations":[{"id":"calculateField","options":{"alias":"Available","binary":{"left":"Capacity","operator":"-","reducer":"sum","right":"Requests"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"organize","options":{"excludeByName":{"Available":true},"indexByName":{"Allocatable":1,"Requests":2,"Time":0,"Used":3},"renameByName":{}}}],"type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(255, 255, 255)","mode":"fixed"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"bytes"},"overrides":[{"matcher":{"id":"byName","options":"Available"},"properties":[{"id":"color"}]}]},"gridPos":{"h":4,"w":6,"x":18,"y":5},"id":97,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"titleSize":15,"valueSize":16},"textMode":"value_and_name"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(kube_node_status_capacity{job=\"gpu-metrics\", node=~\"$node\", resource=\"ephemeral_storage\"}) OR clamp_max(absent(kube_node_status_capacity{job=\"gpu-metrics\", node=~\"$node\", resource=\"ephemeral_storage\"}), 0)","instant":false,"interval":"","legendFormat":"Allocatable","refId":"A"},{"exemplar":true,"expr":"(sum(storage_node_disk_scheduled_bytes{node=~\"$node\"}) or clamp_max(absent(storage_node_disk_scheduled_bytes{node=~\"$node\"}),0)) + (sum(longhorn_node_storage_reservation_bytes{node=~\"$node\"}) or clamp_max(absent(longhorn_node_storage_reservation_bytes{node=~\"$node\"}), 0))","hide":false,"interval":"","legendFormat":"Requests","refId":"B"},{"exemplar":true,"expr":"sum(longhorn_node_storage_usage_bytes{node=~\"$node\"}) OR clamp_max(absent(longhorn_node_storage_usage_bytes{node=~\"$node\"}), 0)","hide":false,"interval":"","legendFormat":"Used","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"Storage Quota (by Node)","transformations":[{"id":"calculateField","options":{"alias":"Available","binary":{"left":"Capacity","operator":"-","reducer":"sum","right":"Requests"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"organize","options":{"excludeByName":{"Available":true},"indexByName":{"Allocatable":1,"Requests":2,"Time":0,"Used":3},"renameByName":{}}}],"type":"stat"},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":9},"id":44,"panels":[],"title":"GPU Summary [ Node : $node ] [ Workspace : $workspace ]","type":"row"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","displayMode":"auto","filterable":false},"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"GPU Utilization"},"properties":[{"id":"custom.displayMode","value":"lcd-gauge"},{"id":"unit","value":"percent"}]},{"matcher":{"id":"byName","options":"Memory Utilization"},"properties":[{"id":"custom.displayMode","value":"lcd-gauge"},{"id":"unit","value":"percent"}]},{"matcher":{"id":"byName","options":"Memory Usage"},"properties":[{"id":"custom.displayMode","value":"lcd-gauge"},{"id":"unit","value":"percent"}]},{"matcher":{"id":"byName","options":"Temp"},"properties":[{"id":"unit","value":"celsius"},{"id":"custom.width","value":81}]},{"matcher":{"id":"byName","options":"Power"},"properties":[{"id":"unit","value":"watt"},{"id":"custom.width","value":84}]},{"matcher":{"id":"byName","options":"Index"},"properties":[{"id":"custom.width","value":80}]},{"matcher":{"id":"byName","options":"Node"},"properties":[{"id":"custom.width","value":139}]},{"matcher":{"id":"byName","options":"Status"},"properties":[{"id":"custom.width","value":88}]},{"matcher":{"id":"byName","options":"Status"},"properties":[{"id":"custom.displayMode","value":"color-background"},{"id":"mappings","value":[{"from":"","id":1,"text":"Running","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"Ready","to":"","type":1,"value":"0"}]},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null},{"color":"yellow","value":0},{"color":"green","value":1}]}}]}]},"gridPos":{"h":10,"w":24,"x":0,"y":10},"id":2,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"frameIndex":2,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(label_replace(notebook_info * on(exported_namespace) group_left(workspace) database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, workspace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"sum(label_replace(DCGM_FI_DEV_GPU_UTIL{kubernetes_node=~\"$node\", namespace=~\"$namespace\"}, \"notebook\", \"$1\", \"container\", \"(.+)\")) by(UUID, kubernetes_node, gpu, modelName, namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"sum(label_replace(DCGM_FI_DEV_MEM_COPY_UTIL{kubernetes_node=~\"$node\", namespace=~\"$namespace\"}, \"notebook\", \"$1\", \"container\", \"(.+)\")) by(UUID, kubernetes_node, gpu, modelName, namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"sum(label_replace(DCGM_FI_DEV_FB_USED{kubernetes_node=~\"$node\", namespace=~\"$namespace\"} / (DCGM_FI_DEV_FB_FREE{kubernetes_node=~\"$node\", namespace=~\"$namespace\"} + DCGM_FI_DEV_FB_USED{kubernetes_node=~\"$node\", namespace=~\"$namespace\"}) * 100, \"notebook\", \"$1\", \"container\", \"(.+)\")) by(UUID, kubernetes_node, gpu, modelName, namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"},{"exemplar":true,"expr":"sum(label_replace(DCGM_FI_DEV_GPU_TEMP{kubernetes_node=~\"$node\", namespace=~\"$namespace\"}, \"notebook\", \"$1\", \"container\", \"(.+)\")) by(UUID, kubernetes_node, gpu, modelName, namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"E"},{"exemplar":true,"expr":"sum(label_replace(DCGM_FI_DEV_POWER_USAGE{kubernetes_node=~\"$node\", namespace=~\"$namespace\"}, \"notebook\", \"$1\", \"container\", \"(.+)\")) by(UUID, kubernetes_node, gpu, modelName, namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"F"}],"title":"GPU Status","transformations":[{"id":"merge","options":{}},{"id":"groupBy","options":{"fields":{"Status":{"aggregations":["lastNotNull"],"operation":"aggregate"},"UUID":{"aggregations":[],"operation":"groupby"},"Value #A":{"aggregations":["lastNotNull"],"operation":null},"Value #B":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #C":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #D":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #E":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #F":{"aggregations":["lastNotNull"],"operation":"aggregate"},"gpu":{"aggregations":["lastNotNull"],"operation":"aggregate"},"kubernetes_node":{"aggregations":["lastNotNull"],"operation":"aggregate"},"modelName":{"aggregations":["lastNotNull"],"operation":"aggregate"},"notebook":{"aggregations":["lastNotNull"],"operation":"aggregate"},"workspace":{"aggregations":["lastNotNull"],"operation":"aggregate"}}}},{"id":"filterByValue","options":{"filters":[{"config":{"id":"isNull","options":{}},"fieldName":"Value #E (lastNotNull)"},{"config":{"id":"isNull","options":{}},"fieldName":"Value #F (lastNotNull)"}],"match":"all","type":"exclude"}},{"id":"sortBy","options":{"fields":{},"sort":[{"desc":false,"field":"kubernetes_node (lastNotNull)"}]}},{"id":"organize","options":{"excludeByName":{"UUID":true},"indexByName":{"Status (lastNotNull)":3,"UUID":11,"Value #B (lastNotNull)":8,"Value #C (lastNotNull)":9,"Value #D (lastNotNull)":10,"Value #E (lastNotNull)":6,"Value #F (lastNotNull)":7,"gpu (lastNotNull)":1,"kubernetes_node (lastNotNull)":0,"modelName (lastNotNull)":2,"notebook (lastNotNull)":5,"workspace (lastNotNull)":4},"renameByName":{"Status (lastNotNull)":"Status","UUID":"","Value #B (lastNotNull)":"GPU Utilization","Value #C (lastNotNull)":"Memory Utilization","Value #D (lastNotNull)":"Memory Usage","Value #E (lastNotNull)":"Temp","Value #F (lastNotNull)":"Power","gpu (lastNotNull)":"Index","kubernetes_node (lastNotNull)":"Node","modelName (lastNotNull)":"Model","notebook (lastNotNull)":"Notebook","workspace (lastNotNull)":"Workspace"}}}],"type":"table"},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":20},"id":46,"panels":[],"title":"Workspace Summary [ Workspace : $workspace ]","type":"row"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","filterable":false},"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"none"},"overrides":[{"matcher":{"id":"byName","options":"CPU Available"},"properties":[{"id":"unit","value":"core"},{"id":"decimals","value":3}]},{"matcher":{"id":"byName","options":"GPU Available"},"properties":[{"id":"unit","value":"unit"}]},{"matcher":{"id":"byName","options":"Memory Available"},"properties":[{"id":"unit","value":"bytes"},{"id":"decimals","value":3}]},{"matcher":{"id":"byName","options":"Storage Available"},"properties":[{"id":"unit","value":"bytes"},{"id":"decimals","value":3}]},{"matcher":{"id":"byName","options":"Status"},"properties":[{"id":"custom.displayMode","value":"color-background"},{"id":"mappings","value":[{"from":"","id":1,"text":"Running","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"Waiting","to":"","type":1,"value":"0"}]},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null},{"color":"yellow","value":0},{"color":"green","value":1}]}}]}]},"gridPos":{"h":10,"w":24,"x":0,"y":21},"id":68,"options":{"frameIndex":3,"showHeader":true,"sortBy":[{"desc":true,"displayName":"notebook"}]},"pluginVersion":"7.5.17","targets":[{"datasource":"Prometheus","exemplar":true,"expr":"sum(label_replace(label_replace(database_workspace_info{exported_namespace=~\"$namespace\"},\"Status\", \"1\", \"status\", \"RUNNING\"),\"Status\", \"0\", \"status\", \"WAITING\") ) by (exported_namespace, workspace, Status)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"(sum(label_replace(kube_resourcequota{job=\"gpu-metrics\", resource=\"cpu\", type=\"hard\"}, \"exported_namespace\", \"$1\", \"namespace\", \"(.+)\") and on(exported_namespace) database_workspace_info) by (exported_namespace) * 1/$buffer_factor)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"sum(label_replace(kube_resourcequota{job=\"gpu-metrics\", resource=\"requests.nvidia.com/gpu\", type=\"hard\"}, \"exported_namespace\", \"$1\", \"namespace\", \"(.+)\") and on(exported_namespace) database_workspace_info) by (exported_namespace) - sum(label_replace(kube_resourcequota{job=\"gpu-metrics\", resource=\"requests.nvidia.com/gpu\", type=\"used\"}, \"exported_namespace\", \"$1\", \"namespace\", \"(.+)\") and on(exported_namespace) database_workspace_info) by (exported_namespace)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"(sum(label_replace(kube_resourcequota{job=\"gpu-metrics\", resource=\"memory\", type=\"hard\"}, \"exported_namespace\", \"$1\", \"namespace\", \"(.+)\") and on(exported_namespace) database_workspace_info) by (exported_namespace) * 1/$buffer_factor)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"},{"exemplar":true,"expr":"sum(label_replace(kube_resourcequota{job=\"gpu-metrics\", resource=\"requests.storage\", type=\"hard\"}, \"exported_namespace\", \"$1\", \"namespace\", \"(.+)\") and on(exported_namespace) database_workspace_info) by (exported_namespace) - sum(label_replace(kube_resourcequota{job=\"gpu-metrics\", resource=\"requests.storage\", type=\"used\"}, \"exported_namespace\", \"$1\", \"namespace\", \"(.+)\") and on(exported_namespace) database_workspace_info) by (exported_namespace)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"E"},{"exemplar":true,"expr":"count(sum(notebook_info * on(exported_namespace) group_left(name) database_workspace_info) by (exported_namespace, notebook)) by (exported_namespace)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"F"},{"exemplar":true,"expr":"count(label_replace(kube_persistentvolumeclaim_info{job=\"gpu-metrics\"}, \"exported_namespace\", \"$1\", \"namespace\", \"(.+)\") and on(exported_namespace) database_workspace_info) by (exported_namespace)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"G"},{"exemplar":true,"expr":"-(sum(label_replace(kube_pod_container_resource_requests{job=\"gpu-metrics\", resource=\"cpu\", container!='istio-proxy'}, \"exported_namespace\", \"$1\", \"namespace\", \"(.+)\") and on (pod) label_replace(notebook_info, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", phase=\"Running\"} == 1)) by (exported_namespace))","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"H"},{"exemplar":true,"expr":"-(sum(label_replace(kube_pod_container_resource_requests{job=\"gpu-metrics\", resource=\"cpu\", container='tensorboard'}, \"exported_namespace\", \"$1\", \"namespace\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", phase=\"Running\"} == 1)) by (exported_namespace))","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"I"},{"exemplar":true,"expr":"-(sum(label_replace(kube_pod_container_resource_requests{job=\"gpu-metrics\", resource=\"memory\", container!='istio-proxy'}, \"exported_namespace\", \"$1\", \"namespace\", \"(.+)\") and on (pod) label_replace(notebook_info, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", phase=\"Running\"} == 1)) by (exported_namespace))","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"J"},{"exemplar":true,"expr":"-(sum(label_replace(kube_pod_container_resource_requests{job=\"gpu-metrics\", resource=\"memory\", container='tensorboard'}, \"exported_namespace\", \"$1\", \"namespace\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", phase=\"Running\"} == 1)) by (exported_namespace))","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"K"}],"title":"Workspace Status","transformations":[{"id":"merge","options":{}},{"id":"sortBy","options":{"fields":{},"sort":[{"desc":true,"field":"Status"}]}},{"id":"filterByValue","options":{"filters":[{"config":{"id":"greater","options":{"value":0}},"fieldName":"Value #A"}],"match":"any","type":"include"}},{"id":"calculateField","options":{"alias":"cpu_exclude_buffer","mode":"reduceRow","reduce":{"include":["Value #H","Value #I"],"reducer":"sum"}}},{"id":"calculateField","options":{"alias":"memory_exclude_buffer","mode":"reduceRow","reduce":{"include":["Value #J","Value #K"],"reducer":"sum"}}},{"id":"calculateField","options":{"alias":"cpu_available","binary":{"left":"Value #B","operator":"+","reducer":"sum","right":"cpu_exclude_buffer"},"mode":"binary","reduce":{"include":[],"reducer":"sum"}}},{"id":"calculateField","options":{"alias":"CPU Available","mode":"reduceRow","reduce":{"include":["cpu_available"],"reducer":"max"}}},{"id":"calculateField","options":{"alias":"memory_available","binary":{"left":"Value #D","operator":"+","reducer":"sum","right":"memory_exclude_buffer"},"mode":"binary","reduce":{"include":[],"reducer":"sum"}}},{"id":"calculateField","options":{"alias":"Memory Available","mode":"reduceRow","reduce":{"include":["memory_available"],"reducer":"max"}}},{"id":"organize","options":{"excludeByName":{"Time":true,"Value #A":true,"Value #B":true,"Value #C":false,"Value #D":true,"Value #E":false,"Value #H":true,"Value #I":true,"Value #J":true,"Value #K":true,"cpu_available":true,"cpu_exclude_buffer":true,"exported_namespace":true,"memory_available":true,"memory_exclude_buffer":true},"indexByName":{"CPU Available":16,"Memory Available":18,"Status":2,"Time":1,"Value #A":4,"Value #B":5,"Value #C":19,"Value #D":6,"Value #E":20,"Value #F":7,"Value #G":8,"Value #H":9,"Value #I":10,"Value #J":11,"Value #K":12,"cpu_available":15,"cpu_exclude_buffer":13,"exported_namespace":3,"memory_available":17,"memory_exclude_buffer":14,"workspace":0},"renameByName":{"Time":"","Value #C":"GPU Available","Value #D":"","Value #E":"Storage Available","Value #F":"Notebooks","Value #G":"Volumes","workspace":"Workspace"}}}],"type":"table"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","filterable":false},"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.4},{"color":"orange","value":0.6},{"color":"red","value":0.8}]}},"overrides":[{"matcher":{"id":"byName","options":"Status"},"properties":[{"id":"noValue","value":"Stopped"},{"id":"mappings","value":[{"from":"","id":1,"text":"Failed","to":"","type":1,"value":"0"},{"from":"","id":2,"text":"Running","to":"","type":1,"value":"1"},{"from":"","id":3,"text":"Pending","to":"","type":1,"value":"2"},{"from":"","id":4,"text":"Succeeded","to":"","type":1,"value":"3"},{"from":"","id":5,"text":"Unknown","to":"","type":1,"value":"4"}]},{"id":"custom.displayMode","value":"color-background"},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"yellow","value":null},{"color":"green","value":1},{"color":"orange","value":2},{"color":"green","value":3},{"color":"yellow","value":4}]}},{"id":"custom.width","value":100}]},{"matcher":{"id":"byName","options":"GPU Limit"},"properties":[{"id":"unit","value":"unit"},{"id":"custom.width","value":110}]},{"matcher":{"id":"byName","options":"GPU Used"},"properties":[{"id":"unit","value":"unit"},{"id":"custom.width","value":110}]},{"matcher":{"id":"byName","options":"CPU Usage"},"properties":[{"id":"unit","value":"percentunit"},{"id":"custom.displayMode","value":"basic"},{"id":"decimals","value":2}]},{"matcher":{"id":"byName","options":"GPU Usage"},"properties":[{"id":"unit","value":"percentunit"},{"id":"custom.displayMode","value":"basic"}]},{"matcher":{"id":"byName","options":"Memory Usage"},"properties":[{"id":"unit","value":"percentunit"},{"id":"custom.displayMode","value":"basic"},{"id":"decimals","value":2}]},{"matcher":{"id":"byName","options":"Mounted Volumes"},"properties":[{"id":"custom.width","value":160}]},{"matcher":{"id":"byName","options":"Workspace"},"properties":[{"id":"custom.width","value":232}]},{"matcher":{"id":"byName","options":"namespace"},"properties":[{"id":"custom.width","value":null}]}]},"gridPos":{"h":10,"w":24,"x":0,"y":31},"id":83,"options":{"frameIndex":1,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"label_replace(label_replace(label_replace((label_replace(label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\"), \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\") * on (namespace, pod) group_left(Status) (label_replace(label_replace(label_replace(label_replace(label_replace(kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\"}, \"Status\", \"0\", \"phase\", \"Failed\"), \"Status\", \"1\", \"phase\", \"Running\"), \"Status\", \"2\", \"phase\", \"Pending\"), \"Status\", \"3\", \"phase\", \"Succeeded\"), \"Status\", \"4\", \"phase\", \"Unknown\") == 1)) * on(exported_namespace) group_left(name) database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\"), \"pod\", \"$1\", \"exported_pod\", \"(.+)\"), \"workspace\", \"$1\", \"name\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"label_replace(label_replace(label_replace(label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") * on(exported_namespace) group_left(name) database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\"), \"pod\", \"$1\", \"exported_pod\", \"(.+)\"), \"workspace\", \"$1\", \"name\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"(sum(label_replace(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container=~\".+\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"}) by (namespace, notebook) / sum(label_replace(kube_pod_container_resource_limits{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container=~\".+\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"}) by (namespace, notebook)) and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"count(label_replace(DCGM_FI_DEV_GPU_UTIL >= 0, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"} and on (namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"},{"exemplar":true,"expr":"count(label_replace(DCGM_FI_DEV_GPU_UTIL == 0, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"} and on (namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"E"},{"exemplar":true,"expr":"(sum(label_replace(container_memory_working_set_bytes{namespace=~\"$namespace\", service=\"kube-prometheus-stack-kubelet\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"}) by (namespace, notebook) / sum(label_replace(kube_pod_container_resource_limits{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container=~\".+\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"}) by (namespace, notebook)) and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"F"},{"exemplar":true,"expr":"sum(notebook_info{persistentvolumeclaim!=\"NONE\"} and on (exported_namespace) database_workspace_info{exported_namespace=~\"$namespace\"}) by (notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"G"},{"exemplar":true,"expr":"sum(label_replace(database_workspace_info{exported_namespace=~\"$namespace\"} and on(exported_namespace) notebook_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, workspace)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"H"}],"timeFrom":null,"timeShift":null,"title":"Notebook Status","transformations":[{"id":"merge","options":{}},{"id":"calculateField","options":{"alias":"gpu_free_temp","mode":"reduceRow","reduce":{"include":["Value #E"],"reducer":"sum"}}},{"id":"calculateField","options":{"alias":"gpu_used_temp","binary":{"left":"Value #D","operator":"-","reducer":"sum","right":"gpu_free_temp"},"mode":"binary","reduce":{"include":[],"reducer":"diff"}}},{"id":"calculateField","options":{"alias":"GPU Used","mode":"reduceRow","reduce":{"include":["gpu_used_temp"],"reducer":"max"}}},{"id":"calculateField","options":{"alias":"gpu_usage_temp","binary":{"left":"GPU Used","operator":"/","reducer":"sum","right":"Value #D"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"calculateField","options":{"alias":"GPU Usage","mode":"reduceRow","reduce":{"include":["gpu_usage_temp"],"reducer":"max"}}},{"id":"sortBy","options":{"fields":{},"sort":[{"desc":false,"field":"namespace"}]}},{"id":"groupBy","options":{"fields":{"GPU Usage":{"aggregations":["last"],"operation":"aggregate"},"GPU Used":{"aggregations":["last"],"operation":"aggregate"},"Status":{"aggregations":[],"operation":"groupby"},"Value #C":{"aggregations":["last"],"operation":"aggregate"},"Value #D":{"aggregations":["last"],"operation":"aggregate"},"Value #E":{"aggregations":["lastNotNull"],"operation":null},"Value #F":{"aggregations":["last"],"operation":"aggregate"},"Value #G":{"aggregations":["last"],"operation":"aggregate"},"namespace":{"aggregations":[],"operation":"groupby"},"notebook":{"aggregations":[],"operation":"groupby"},"workspace":{"aggregations":["last"],"operation":"aggregate"}}}},{"id":"organize","options":{"excludeByName":{"namespace":true},"indexByName":{"GPU Usage (last)":8,"GPU Used (last)":5,"Status":2,"Value #C (last)":7,"Value #D (last)":4,"Value #F (last)":9,"Value #G (last)":6,"namespace":3,"notebook":0,"workspace (last)":1},"renameByName":{"GPU Usage (last)":"GPU Usage","GPU Used (last)":"GPU Used","Status":"Status","Value #C (last)":"CPU Usage","Value #D (last)":"GPU Limit","Value #F (last)":"Memory Usage","Value #G (last)":"Mounted Volumes","namespace":"","notebook":"Notebook","workspace (last)":"Workspace"}}}],"type":"table"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":41},"id":28,"panels":[{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","displayMode":"color-background","filterable":false},"mappings":[{"from":"","id":1,"text":"True","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"False","to":"","type":1,"value":"0"},{"from":"","id":3,"text":"Unknown","to":"","type":1,"value":"-1"}],"thresholds":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null},{"color":"yellow","value":-1},{"color":"green","value":0},{"color":"red","value":1}]}},"overrides":[{"matcher":{"id":"byName","options":"Role"},"properties":[{"id":"custom.displayMode","value":"auto"},{"id":"noValue","value":"woker"},{"id":"mappings","value":[{"from":"","id":1,"text":"master","to":"","type":1,"value":"1"}]}]},{"matcher":{"id":"byName","options":"Ready"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"True","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"False","to":"","type":1,"value":"0"},{"from":"","id":3,"text":"Unknown","to":"","type":1,"value":"-1"}]},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null},{"color":"yellow","value":-1},{"color":"red","value":0},{"color":"green","value":1}]}}]},{"matcher":{"id":"byName","options":"Volume Schedulable"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"True","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"False","to":"","type":1,"value":"0"}]},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null},{"color":"red","value":0},{"color":"green","value":1}]}}]},{"matcher":{"id":"byName","options":"Network Available"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"True","to":"","type":1,"value":"0"},{"from":"","id":2,"text":"False","to":"","type":1,"value":"1"},{"from":"","id":3,"text":"Unknown","to":"","type":1,"value":"-1"}]}]},{"matcher":{"id":"byName","options":"Node"},"properties":[{"id":"custom.width","value":163}]}]},"gridPos":{"h":8,"w":24,"x":0,"y":42},"id":70,"options":{"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"kube_node_info{job=\"gpu-metrics\", node=~\"$node\"}","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"sum(kube_node_role{job=\"gpu-metrics\", node=~\"$node\", role=\"master\"} OR clamp_max(absent(kube_node_role{job=\"gpu-metrics\", node=~\"$node\", role=\"master\"}), 0)) by (node, role)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"sum(label_replace(label_replace(label_replace(kube_node_status_condition{job=\"gpu-metrics\", node=~\"$node\", condition=\"Ready\"}, \"Ready\", \"1\", \"status\", \"true\"), \"Ready\", \"0\", \"status\", \"false\"), \"Ready\", \"-1\", \"status\", \"unknown\") == 1) by (node, Ready)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"sum(label_replace(label_replace(label_replace(kube_node_status_condition{job=\"gpu-metrics\", node=~\"$node\", condition=\"DiskPressure\"}, \"DiskPressure\", \"1\", \"status\", \"true\"),\"DiskPressure\", \"0\", \"status\", \"false\"),\"DiskPressure\", \"-1\", \"status\", \"unknown\") == 1) by (node, DiskPressure)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"},{"exemplar":true,"expr":"sum(label_replace(label_replace(label_replace(kube_node_status_condition{job=\"gpu-metrics\", node=~\"$node\", condition=\"MemoryPressure\"}, \"MemoryPressure\", \"1\", \"status\", \"true\"),\"MemoryPressure\", \"0\", \"status\", \"false\"),\"MemoryPressure\", \"-1\", \"status\", \"unknown\") == 1) by (node, MemoryPressure)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"E"},{"exemplar":true,"expr":"sum(label_replace(label_replace(label_replace(kube_node_status_condition{job=\"gpu-metrics\", node=~\"$node\", condition=\"NetworkUnavailable\"}, \"NetworkUnavailable\", \"1\", \"status\", \"true\"), \"NetworkUnavailable\", \"0\", \"status\", \"false\"), \"NetworkUnavailable\", \"-1\", \"status\", \"unknown\") == 1) by (node, NetworkUnavailable)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"F"},{"exemplar":true,"expr":"sum(label_replace(label_replace(label_replace(kube_node_status_condition{job=\"gpu-metrics\", node=~\"$node\", condition=\"PIDPressure\"}, \"PIDPressure\", \"1\", \"status\", \"true\"),\"PIDPressure\", \"0\", \"status\", \"false\"),\"PIDPressure\", \"-1\", \"status\", \"unknown\") == 1) by (node, PIDPressure)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"G"},{"exemplar":true,"expr":"sum(label_replace(label_replace(storage_node_disk_condition{node=~\"$node\", condition=\"Schedulable\"}, \"Schedulable\", \"1\", \"status\", \"True\"), \"Schedulable\", \"1\", \"status\", \"False\") == 1) by (node, Schedulable)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"H"}],"title":"Node Status","transformations":[{"id":"merge","options":{}},{"id":"sortBy","options":{"fields":{},"sort":[{"field":"role"}]}},{"id":"organize","options":{"excludeByName":{"Time":true,"Value #A":true,"Value #B":false,"Value #C":true,"Value #D":true,"Value #E":true,"Value #F":true,"Value #G":true,"Value #H":true,"__name__":true,"container_runtime_version":true,"instance":true,"job":true,"kernel_version":true,"kubelet_version":true,"kubeproxy_version":true,"kubernetes_node":true,"pod_cidr":true,"role":true,"system_uuid":true},"indexByName":{"DiskPressure":10,"MemoryPressure":11,"NetworkUnavailable":9,"PIDPressure":12,"Ready":7,"Schedulable":8,"Time":13,"Value #A":22,"Value #B":5,"Value #C":23,"Value #D":24,"Value #E":25,"Value #F":26,"Value #G":27,"Value #H":28,"__name__":14,"container_runtime_version":3,"instance":15,"internal_ip":4,"job":16,"kernel_version":2,"kubelet_version":17,"kubeproxy_version":18,"kubernetes_node":19,"node":0,"os_image":1,"pod_cidr":20,"role":6,"system_uuid":21},"renameByName":{"DiskPressure":"Disk Pressure","MemoryPressure":"Memory Pressure","NetworkUnavailable":"Network Available","PIDPressure":"PID Pressure","Schedulable":"Volume Schedulable","Value #B":"Role","Value #I":"Replicas","container_runtime_version":"Container Runtime","internal_ip":"Internal IP","kernel_version":"Kernel","node":"Node","os_image":"OS","role":"Role"}}}],"type":"table"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","displayMode":"auto","filterable":false},"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null}]}},"overrides":[{"matcher":{"id":"byName","options":"Replica Status"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"Running","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"Ready","to":"","type":1,"value":"0"}]},{"id":"custom.displayMode","value":"color-background"},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null},{"color":"yellow","value":0},{"color":"green","value":1}]}}]},{"matcher":{"id":"byName","options":"Capacity"},"properties":[{"id":"unit","value":"bytes"},{"id":"decimals","value":3}]},{"matcher":{"id":"byName","options":"Used"},"properties":[{"id":"unit","value":"bytes"},{"id":"decimals","value":3}]},{"matcher":{"id":"byName","options":"Volume Status"},"properties":[{"id":"custom.displayMode","value":"color-background"},{"id":"mappings","value":[{"from":"","id":1,"text":"Available","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"Bound","to":"","type":1,"value":"2"},{"from":"","id":3,"text":"Released","to":"","type":1,"value":"3"},{"from":"","id":4,"text":"Fail","to":"","type":1,"value":"0"}]},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null},{"color":"red","value":0},{"color":"yellow","value":1},{"color":"green","value":2},{"color":"yellow","value":3}]}}]}]},"gridPos":{"h":11,"w":24,"x":0,"y":50},"id":114,"options":{"frameIndex":2,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"label_replace(label_replace(label_replace(label_replace(label_replace(label_replace(storage_volume_replica_info{node=~\"$node\"} * on (diskID) group_left (node) storage_node_disk_info{node=~\"$node\"}, \"Running\", \"1\", \"running\", \"True\"), \"Running\", \"0\", \"running\", \"False\"), \"Status\", \"1\", \"pvStatus\", \"Available\"), \"Status\", \"2\", \"pvStatus\", \"Bound\"), \"Status\", \"3\", \"pvStatus\", \"Released\"), \"Status\", \"0\", \"pvStatus\", \"Fail\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"sum(kube_persistentvolume_capacity_bytes{job=\"gpu-metrics\"} and on (persistentvolume) storage_volume_replica_info * on (diskID) group_left (node) storage_node_disk_info{node=~\"$node\"}) by (persistentvolume)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"sum(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\")) by (persistentvolume)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"sum(label_replace(kube_persistentvolume_claim_ref{job=\"gpu-metrics\"}, \"persistentvolumeclaim\", \"$1\", \"name\", \"(.+)\") * on(claim_namespace) group_left(workspace) label_replace(database_workspace_info, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\") and on (persistentvolume) storage_volume_replica_info * on (diskID) group_left (node) storage_node_disk_info{node=~\"$node\"}) by (workspace, claim_namespace, persistentvolumeclaim, persistentvolume)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"}],"title":"Storage Status (by Volume Replica)","transformations":[{"id":"merge","options":{}},{"id":"filterByValue","options":{"filters":[{"config":{"id":"greater","options":{"value":0}},"fieldName":"Value #B"}],"match":"any","type":"include"}},{"id":"organize","options":{"excludeByName":{"Time":true,"Value #A":true,"Value #D":true,"address":true,"claim_namespace":true,"container":true,"dataPath":true,"diskID":true,"diskPath":true,"endpoint":true,"instance":true,"job":true,"mode":true,"namespace":true,"persistentvolume":true,"pod":true,"pvStatus":true,"replica":true,"running":true,"service":true,"volume":true},"indexByName":{"Running":4,"Status":3,"Time":11,"Value #A":25,"Value #B":9,"Value #C":10,"Value #D":27,"address":12,"claim_namespace":26,"container":13,"dataPath":7,"diskID":14,"diskPath":15,"endpoint":16,"instance":17,"job":18,"mode":19,"namespace":20,"node":1,"persistentvolume":21,"persistentvolumeclaim":0,"pod":22,"pvStatus":5,"replica":8,"running":6,"service":23,"volume":24,"workspace":2},"renameByName":{"Running":"Replica Status","Status":"Volume Status","Value #B":"Capacity","Value #C":"Used","dataPath":"Replica Path","node":"Node","persistentvolumeclaim":"Volume","pvStatus":"","replica":"Replica","running":"","workspace":"Workspace"}}},{"id":"sortBy","options":{"fields":{},"sort":[{"field":"Volume"}]}}],"type":"table"},{"datasource":null,"fieldConfig":{"defaults":{"custom":{"align":"center","filterable":false},"decimals":3,"mappings":[{"from":"","id":1,"text":"","to":"","type":1,"value":""}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"core"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":61},"id":32,"options":{"frameIndex":1,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"kube_node_status_allocatable{job=\"kube-state-metrics\", resource=\"cpu\", node=~\"$node\"}","format":"table","instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"sum(kube_pod_container_resource_requests{job=\"kube-state-metrics\", resource=\"cpu\", node=~\"$node\"}) by(node)","format":"table","instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{node=~\"$node\", container=~\".+\"}","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"}],"timeFrom":null,"timeShift":null,"title":"CPU Quotas (by Node)","transformations":[{"id":"merge","options":{}},{"id":"groupBy","options":{"fields":{"Value":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #A":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #B":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #C":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #D":{"aggregations":["sum"],"operation":"aggregate"},"node":{"aggregations":[],"operation":"groupby"}}}},{"id":"organize","options":{"excludeByName":{},"indexByName":{"Value #A (lastNotNull)":1,"Value #B (lastNotNull)":2,"Value #C (lastNotNull)":4,"Value #D (sum)":3,"node":0},"renameByName":{"Value #A (lastNotNull)":"Capacity","Value #B (lastNotNull)":"Requests","Value #C (lastNotNull)":"Available","Value #D (lastNotNull)":"","Value #D (sum)":"Used","Value (lastNotNull)":"not used","node":"Node"}}}],"type":"table"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"description":"","fieldConfig":{"defaults":{"unit":"percentunit"},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":61},"hiddenSeries":false,"id":34,"interval":"1m","legend":{"alignAsTable":true,"avg":false,"current":true,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"alertThreshold":true},"percentage":true,"pluginVersion":"7.5.17","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"(sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", node=~\"$node\", container=~\".+\"}) by (node)\n OR clamp_max(absent(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", node=~\"$node\", container=~\".+\"}),0)) / sum(kube_node_status_allocatable{job=\"gpu-metrics\", node=~\"$node\", resource=\"cpu\"}) by (node)","format":"time_series","hide":false,"interval":"","intervalFactor":2,"legendFormat":"{{node}}","legendLink":null,"refId":"A","step":10}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"CPU Usage (by Node)","tooltip":{"shared":false,"sort":2,"value_type":"individual"},"transformations":[],"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":2,"format":"percentunit","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"datasource":null,"fieldConfig":{"defaults":{"custom":{"align":"center","filterable":false},"mappings":[{"from":"","id":1,"text":"","to":"","type":1,"value":""}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"unit"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":69},"id":24,"options":{"frameIndex":1,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"kube_node_status_allocatable{job=\"kube-state-metrics\", resource=\"nvidia_com_gpu\", node=~\"$node\"}","format":"table","instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"sum(kube_pod_container_resource_requests{job=\"kube-state-metrics\", resource=\"nvidia_com_gpu\", node=~\"$node\"}) by(node)","format":"table","instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"count(DCGM_FI_DEV_GPU_UTIL{kubernetes_node=~\"$node\"} > 0) OR clamp_max(absent(DCGM_FI_DEV_GPU_UTIL{kubernetes_node=~\"$node\"} > 0), 0)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"}],"timeFrom":null,"timeShift":null,"title":"GPU Quotas (by Node)","transformations":[{"id":"merge","options":{}},{"id":"groupBy","options":{"fields":{"Value":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #A":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #B":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #C":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #D":{"aggregations":["lastNotNull"],"operation":"aggregate"},"node":{"aggregations":[],"operation":"groupby"}}}},{"id":"organize","options":{"excludeByName":{},"indexByName":{"Value #A (lastNotNull)":1,"Value #B (lastNotNull)":2,"Value #C (lastNotNull)":4,"Value #D (lastNotNull)":3,"node":0},"renameByName":{"Value #A (lastNotNull)":"Capacity","Value #B (lastNotNull)":"Requests","Value #C (lastNotNull)":"Available","Value #D (lastNotNull)":"Used","Value (lastNotNull)":"not used","node":"Node"}}}],"type":"table"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"fieldConfig":{"defaults":{"unit":"mbytes"},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":69},"hiddenSeries":false,"id":26,"legend":{"alignAsTable":true,"avg":false,"current":true,"max":false,"min":false,"rightSide":true,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.17","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"exemplar":true,"expr":"DCGM_FI_DEV_FB_USED{kubernetes_node=~\"$node\"}","format":"time_series","instant":false,"interval":"","legendFormat":"{{kubernetes_node}}/{{gpu}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"GPU Memory Usage (by GPU Unit)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transformations":[],"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"mbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"datasource":null,"fieldConfig":{"defaults":{"custom":{"align":"center","filterable":false},"decimals":3,"mappings":[{"from":"","id":1,"text":"","to":"","type":1,"value":""}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":77},"id":36,"options":{"frameIndex":1,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"kube_node_status_allocatable{job=\"kube-state-metrics\", resource=\"memory\", node=~\"$node\"}","format":"table","instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"sum(kube_pod_container_resource_requests{job=\"kube-state-metrics\", resource=\"memory\", node=~\"$node\"}) by(node)","format":"table","instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"sum(container_memory_working_set_bytes{node=~\"$node\", service=\"kube-prometheus-stack-kubelet\"}) by(node)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"}],"timeFrom":null,"timeShift":null,"title":"Memory Quotas (by Node)","transformations":[{"id":"merge","options":{}},{"id":"groupBy","options":{"fields":{"Value":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #A":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #B":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #C":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #D":{"aggregations":["sum"],"operation":"aggregate"},"node":{"aggregations":[],"operation":"groupby"}}}},{"id":"organize","options":{"excludeByName":{},"indexByName":{"Value #A (lastNotNull)":1,"Value #B (lastNotNull)":2,"Value #C (lastNotNull)":4,"Value #D (sum)":3,"node":0},"renameByName":{"Value #A (lastNotNull)":"Capacity","Value #B (lastNotNull)":"Requests","Value #C (lastNotNull)":"Available","Value #D (lastNotNull)":"","Value #D (sum)":"Used","Value (lastNotNull)":"not used","node":"Node"}}}],"type":"table"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"description":"","fieldConfig":{"defaults":{"unit":"percentunit"},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":77},"hiddenSeries":false,"id":38,"interval":"1m","legend":{"alignAsTable":true,"avg":false,"current":true,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"alertThreshold":true},"percentage":true,"pluginVersion":"7.5.17","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"(sum(container_memory_working_set_bytes{node=~\"$node\", service=\"kube-prometheus-stack-kubelet\"}) by (node)\n OR clamp_max(absent(container_memory_working_set_bytes{node=~\"$node\", service=\"kube-prometheus-stack-kubelet\"}),0)) / sum(kube_node_status_allocatable{job=\"gpu-metrics\", node=~\"$node\", resource=\"memory\"}) by (node)","format":"time_series","hide":false,"interval":"","intervalFactor":2,"legendFormat":"{{node}}","legendLink":null,"refId":"A","step":10}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory Usage (by Node)","tooltip":{"shared":false,"sort":2,"value_type":"individual"},"transformations":[],"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":2,"format":"percentunit","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"datasource":null,"fieldConfig":{"defaults":{"custom":{"align":"center","filterable":false},"decimals":3,"mappings":[{"from":"","id":1,"text":"","to":"","type":1,"value":""}],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":85},"id":100,"options":{"frameIndex":1,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"kube_node_status_capacity{job=\"gpu-metrics\", node=~\"$node\", resource=\"ephemeral_storage\"}","format":"table","instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"(storage_node_disk_scheduled_bytes{node=~\"$node\"} + on (node) longhorn_node_storage_reservation_bytes{node=~\"$node\"})","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"longhorn_node_storage_usage_bytes{node=~\"$node\"}","format":"table","instant":true,"interval":"","legendFormat":"","refId":"D"}],"timeFrom":null,"timeShift":null,"title":"Storage Quotas (by Node)","transformations":[{"id":"merge","options":{}},{"id":"groupBy","options":{"fields":{"Value":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #A":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #B":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #C":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #D":{"aggregations":["sum"],"operation":"aggregate"},"Value #E":{"aggregations":["lastNotNull"],"operation":"aggregate"},"node":{"aggregations":[],"operation":"groupby"}}}},{"id":"organize","options":{"excludeByName":{"Value #B (lastNotNull)":false,"Value #C (lastNotNull)":false},"indexByName":{"Value #A (lastNotNull)":1,"Value #B (lastNotNull)":2,"Value #C (lastNotNull)":4,"Value #D (sum)":3,"node":0},"renameByName":{"Available":"","Value #A (lastNotNull)":"Capacity","Value #B (lastNotNull)":"Requests","Value #C (lastNotNull)":"","Value #D (lastNotNull)":"","Value #D (sum)":"Used","Value #E (lastNotNull)":"Available","Value (lastNotNull)":"not used","node":"Node"}}}],"type":"table"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"description":"","fieldConfig":{"defaults":{"unit":"percentunit"},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":85},"hiddenSeries":false,"id":42,"interval":"1m","legend":{"alignAsTable":true,"avg":false,"current":true,"hideEmpty":false,"hideZero":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"alertThreshold":true},"percentage":true,"pluginVersion":"7.5.17","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"sum(longhorn_node_storage_usage_bytes{node=~\"$node\"}) by (node) / sum(kube_node_status_capacity{job=\"gpu-metrics\", node=~\"$node\", resource=\"ephemeral_storage\"}) by (node)","format":"time_series","hide":false,"instant":false,"interval":"","intervalFactor":2,"legendFormat":"{{node}}","legendLink":null,"refId":"A","step":10}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Storage Usage (by Node)","tooltip":{"shared":false,"sort":2,"value_type":"individual"},"transformations":[],"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":2,"format":"percentunit","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Node Details [ Node : $node ]","type":"row"},{"collapsed":true,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":42},"id":64,"panels":[{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":0,"y":43},"id":121,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"valueSize":65},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"(sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container!~\"istio.*\", container=~\".+\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))\n OR clamp_max(absent(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container!~\"istio.*\",  container=~\".+\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")),0)) / (sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", type=\"hard\"} > 0 and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) * 1/$buffer_factor) * 100","hide":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"CPU Usage (by Workspace)","type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":3,"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":6,"y":43},"id":122,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"valueSize":65},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"(count(DCGM_FI_DEV_GPU_UTIL > 0 and on(namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) or clamp_max(absent(DCGM_FI_DEV_GPU_UTIL > 0 and on(namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")), 0)) / sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.nvidia.com/gpu\", type=\"hard\"} > 0 and on(namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) * 100","hide":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"GPU Usage (by Workspace)","type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":12,"y":43},"id":123,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"valueSize":65},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"(sum(container_memory_working_set_bytes{namespace=~\"$namespace\", container!~\"istio.*\", service=\"kube-prometheus-stack-kubelet\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) OR clamp_max(absent(container_memory_working_set_bytes{namespace=~\"$namespace\", container!~\"istio.*\", service=\"kube-prometheus-stack-kubelet\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")),0)) / (sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", type=\"hard\"} > 0 and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) * 1/$buffer_factor) * 100","hide":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Memory Usage (by Workspace)","type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":18,"y":43},"id":124,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"valueSize":65},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"(sum(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) (kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"} and on(claim_namespace) label_replace(database_workspace_info, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))) OR clamp_max(absent(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) (kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"} and on(claim_namespace) label_replace(database_workspace_info, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))), 0)) / (sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.storage\", type=\"hard\"} > 0 and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))) * 100","hide":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Storage Usage (by Workspace)","type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(255, 255, 255)","mode":"fixed"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"core"},"overrides":[{"matcher":{"id":"byName","options":"Available"},"properties":[{"id":"color"}]}]},"gridPos":{"h":5,"w":6,"x":0,"y":46},"id":106,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"titleSize":15,"valueSize":16},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", type=\"hard\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) * 1/$buffer_factor","instant":false,"interval":"","legendFormat":"Limits","refId":"A"},{"exemplar":true,"expr":"(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container!='istio-proxy'} and on (pod) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)) or clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container!='istio-proxy'} and on (pod) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)), 0))\n+\n(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container='tensorboard'} and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)) or clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container='tensorboard'} and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)), 0))","hide":false,"interval":"","legendFormat":"Requests","refId":"B"},{"exemplar":true,"expr":"sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container!~\"istio.*\", container=~\".+\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) OR clamp_max(absent(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container!~\"istio.*\", container=~\".+\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")), 0)","hide":false,"interval":"","legendFormat":"Used","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"CPU Quota (by Workspace)","transformations":[{"id":"calculateField","options":{"alias":"Available","binary":{"left":"Limits","operator":"-","reducer":"sum","right":"Requests"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"organize","options":{"excludeByName":{},"indexByName":{"Available":1,"Limits":2,"Requests":3,"Time":0,"Used":4},"renameByName":{}}}],"type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(255, 255, 255)","mode":"fixed"},"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"unit"},"overrides":[{"matcher":{"id":"byName","options":"Available"},"properties":[{"id":"color"}]}]},"gridPos":{"h":5,"w":6,"x":6,"y":46},"id":107,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"titleSize":15,"valueSize":16},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.nvidia.com/gpu\", type=\"hard\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))","instant":false,"interval":"","legendFormat":"Limits","refId":"A"},{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.nvidia.com/gpu\", type=\"used\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))","hide":false,"interval":"","legendFormat":"Requests","refId":"B"},{"exemplar":true,"expr":"count(DCGM_FI_DEV_GPU_UTIL > 0 and on(namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) or clamp_max(absent(DCGM_FI_DEV_GPU_UTIL > 0 and on(namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")), 0)","hide":false,"interval":"","legendFormat":"Used","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"GPU Quota (by Workspace)","transformations":[{"id":"calculateField","options":{"alias":"Available","binary":{"left":"Limits","operator":"-","reducer":"sum","right":"Requests"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"organize","options":{"excludeByName":{},"indexByName":{"Available":0,"Limits":2,"Requests":3,"Time":1,"Used":4},"renameByName":{}}}],"type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(255, 255, 255)","mode":"fixed"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"bytes"},"overrides":[{"matcher":{"id":"byName","options":"Available"},"properties":[{"id":"color"}]}]},"gridPos":{"h":5,"w":6,"x":12,"y":46},"id":108,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"titleSize":15,"valueSize":16},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", type=\"hard\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) * 1/$buffer_factor","instant":false,"interval":"","legendFormat":"Limits","refId":"A"},{"exemplar":true,"expr":"(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container!='istio-proxy'} and on (pod) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)) or clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container!='istio-proxy'} and on (pod) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)), 0))\n+\n(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container='tensorboard'} and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)) or clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container='tensorboard'} and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)), 0))","hide":false,"interval":"","legendFormat":"Requests","refId":"B"},{"exemplar":true,"expr":"sum(container_memory_working_set_bytes{namespace=~\"$namespace\", container!~\"istio.*\", service=\"kube-prometheus-stack-kubelet\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) OR clamp_max(absent(container_memory_working_set_bytes{namespace=~\"$namespace\", container!~\"istio.*\", service=\"kube-prometheus-stack-kubelet\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")), 0)","hide":false,"interval":"","legendFormat":"Used","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"Memory Quota (by Workspace)","transformations":[{"id":"calculateField","options":{"alias":"Available","binary":{"left":"Limits","operator":"-","reducer":"sum","right":"Requests"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"organize","options":{"excludeByName":{"Time":false},"indexByName":{"Available":1,"Limits":2,"Requests":3,"Time":0,"Used":4},"renameByName":{}}}],"type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(255, 255, 255)","mode":"fixed"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"bytes"},"overrides":[{"matcher":{"id":"byName","options":"Available"},"properties":[{"id":"color"}]}]},"gridPos":{"h":5,"w":6,"x":18,"y":46},"id":109,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"titleSize":15,"valueSize":16},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.storage\", type=\"hard\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) OR clamp_max(absent(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.storage\", type=\"hard\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")), 0)","instant":false,"interval":"","legendFormat":"Limits","refId":"A"},{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.storage\", type=\"used\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) OR clamp_max(absent(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.storage\", type=\"used\"} and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")), 0)","hide":false,"interval":"","legendFormat":"Requests","refId":"B"},{"exemplar":true,"expr":"sum(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) (kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"} and on(claim_namespace) label_replace(database_workspace_info, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))) OR clamp_max(absent(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) (kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"} and on(claim_namespace) label_replace(database_workspace_info, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))), 0)","hide":false,"interval":"","legendFormat":"Used","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"Storage Quota (by Workspace)","transformations":[{"id":"calculateField","options":{"alias":"Available","binary":{"left":"Limits","operator":"-","reducer":"sum","right":"Requests"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"organize","options":{"excludeByName":{},"indexByName":{"Available":0,"Limits":2,"Requests":3,"Time":1,"Used":4},"renameByName":{}}}],"type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","displayMode":"auto","filterable":false},"mappings":[{"from":"","id":1,"text":"1","to":"","type":1,"value":"True"},{"from":"","id":2,"text":"0","to":"","type":1,"value":"False"}],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null},{"color":"yellow","value":0},{"color":"green","value":1}]}},"overrides":[{"matcher":{"id":"byName","options":"Status"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"Available","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"Bound","to":"","type":1,"value":"2"},{"from":"","id":3,"text":"Released","to":"","type":1,"value":"3"},{"from":"","id":4,"text":"Fail","to":"","type":1,"value":"0"}]},{"id":"custom.displayMode","value":"color-background"},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null},{"color":"red","value":0},{"color":"yellow","value":1},{"color":"green","value":2},{"color":"yellow","value":3}]}},{"id":"custom.width","value":150}]},{"matcher":{"id":"byName","options":"State"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"Attached","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"Detached","to":"","type":1,"value":"0"}]},{"id":"custom.displayMode","value":"color-background"},{"id":"custom.width","value":150}]},{"matcher":{"id":"byName","options":"Robustness"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"Healthy","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"UnKnown","to":"","type":1,"value":"0"}]},{"id":"custom.displayMode","value":"color-background"},{"id":"custom.width","value":150}]},{"matcher":{"id":"byName","options":"Usage"},"properties":[{"id":"custom.displayMode","value":"basic"},{"id":"unit","value":"percentunit"},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.4},{"color":"orange","value":0.6},{"color":"red","value":0.8}]}}]}]},"gridPos":{"h":10,"w":24,"x":0,"y":51},"id":105,"options":{"frameIndex":1,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"label_replace(label_replace(label_replace(label_replace(label_replace(label_replace(label_replace(label_replace(storage_volume_info, \"State\", \"1\", \"state\", \"attached\"), \"State\", \"0\", \"state\", \"detached\"), \"Status\", \"1\", \"pvStatus\", \"Available\"), \"Status\", \"2\", \"pvStatus\", \"Bound\"), \"Status\", \"3\", \"pvStatus\", \"Released\"), \"Status\", \"0\", \"pvStatus\", \"Fail\"), \"Robustness\", \"1\", \"robustness\", \"healthy\"), \"Robustness\", \"0\", \"robustness\", \"unknown\") * on (persistentvolume) group_left (claim_namespace) label_replace(kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"}, \"persistentvolumeclaim\", \"$1\", \"name\", \"(.+)\") * on (claim_namespace) group_left (workspace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"sum(label_replace(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"} and on (claim_namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\") and on (persistentvolume) kube_persistentvolume_info{job=\"gpu-metrics\", storageclass=~\"longhorn|longhorn-static\"}, \"persistentvolumeclaim\", \"$1\", \"name\", \"(.+)\") * on(claim_namespace) group_left(workspace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (workspace, persistentvolume, persistentvolumeclaim)\n/\nsum(kube_persistentvolume_capacity_bytes{job=\"gpu-metrics\"} * on (persistentvolume) group_left(namespace, persistentvolumeclaim) label_replace(kube_persistentvolumeclaim_info{job=\"gpu-metrics\", namespace=~\"$namespace\"}, \"persistentvolume\", \"$1\", \"volumename\", \"(.+)\") * on(namespace) group_left(workspace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (workspace, persistentvolume, persistentvolumeclaim)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"}],"title":"Volume Status (by Workspace)","transformations":[{"id":"merge","options":{}},{"id":"sortBy","options":{"fields":{},"sort":[{"field":"claim_namespace"}]}},{"id":"groupBy","options":{"fields":{"Robustness":{"aggregations":[],"operation":"groupby"},"State":{"aggregations":[],"operation":"groupby"},"Status":{"aggregations":[],"operation":"groupby"},"Value #B":{"aggregations":["lastNotNull"],"operation":"aggregate"},"persistentvolume":{"aggregations":[],"operation":"groupby"},"persistentvolumeclaim":{"aggregations":[],"operation":"groupby"},"workspace":{"aggregations":[],"operation":"groupby"}}}},{"id":"filterByValue","options":{"filters":[{"config":{"id":"isNull","options":{}},"fieldName":"Value #B (lastNotNull)"}],"match":"any","type":"exclude"}},{"id":"organize","options":{"excludeByName":{"persistentvolume":true},"indexByName":{"Robustness":5,"State":4,"Status":3,"Value #B (lastNotNull)":6,"persistentvolume":0,"persistentvolumeclaim":2,"workspace":1},"renameByName":{"Value #B (lastNotNull)":"Usage","persistentvolumeclaim":"Volume","workspace":"Workspace"}}}],"type":"table"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","displayMode":"auto","filterable":false},"decimals":3,"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"core"},"overrides":[{"matcher":{"id":"byName","options":"Used"},"properties":[{"id":"decimals","value":6}]},{"matcher":{"id":"byName","options":"Limit"},"properties":[{"id":"custom.width","value":null}]}]},"gridPos":{"h":8,"w":12,"x":0,"y":61},"id":85,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"frameIndex":1,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"label_replace(label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") * on(exported_namespace) group_left(workspace) database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"kube_pod_container_resource_limits{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container=~\".+\"} and on(container) label_replace(notebook_info, \"container\", \"$1\", \"notebook\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container=~\".+\"} and on(container) label_replace(notebook_info, \"container\", \"$1\", \"notebook\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container=~\".+\"} and on(container) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"container\", \"$1\", \"notebook\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"}],"title":"CPU Quotas (by Notebook)","transformations":[{"id":"merge","options":{}},{"id":"sortBy","options":{"fields":{},"sort":[{"desc":false,"field":"namespace"}]}},{"id":"groupBy","options":{"fields":{"Value #A":{"aggregations":[],"operation":null},"Value #B":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #C":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #D":{"aggregations":["lastNotNull"],"operation":"aggregate"},"name":{"aggregations":["lastNotNull"],"operation":null},"namespace":{"aggregations":["lastNotNull"],"operation":null},"node":{"aggregations":["lastNotNull"],"operation":"aggregate"},"notebook":{"aggregations":["lastNotNull"],"operation":"aggregate"},"pod":{"aggregations":[],"operation":"groupby"},"workspace":{"aggregations":["lastNotNull"],"operation":"aggregate"}}}},{"id":"filterByValue","options":{"filters":[{"config":{"id":"isNull","options":{}},"fieldName":"notebook (lastNotNull)"}],"match":"any","type":"exclude"}},{"id":"organize","options":{"excludeByName":{"node (lastNotNull)":true,"pod":true,"workspace (lastNotNull)":false},"indexByName":{"Value #B (lastNotNull)":3,"Value #C (lastNotNull)":4,"Value #D (lastNotNull)":5,"node (lastNotNull)":2,"notebook (lastNotNull)":1,"pod":6,"workspace (lastNotNull)":0},"renameByName":{"Value #B (lastNotNull)":"Limits","Value #C (lastNotNull)":"Requests","Value #D (lastNotNull)":"Used","name (lastNotNull)":"워크스페이스","node (lastNotNull)":"Node","notebook (lastNotNull)":"Notebook","workspace (lastNotNull)":"Workspace"}}}],"type":"table"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"description":"","fieldConfig":{"defaults":{"unit":"percentunit"},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":61},"hiddenSeries":false,"id":87,"interval":"1m","legend":{"alignAsTable":true,"avg":false,"current":true,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"alertThreshold":true},"percentage":true,"pluginVersion":"7.5.17","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"capacity","color":"#F2495C","dashes":true,"fill":0,"hiddenSeries":true,"hideTooltip":true,"legend":true,"linewidth":1,"stack":false},{"alias":"/^(ns-).[0-9]*/","fill":1,"stack":true}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"((sum(label_replace(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container=~\".+\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"}) by (namespace, notebook) / sum(label_replace(kube_pod_container_resource_limits{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container=~\".+\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"}) by (namespace, notebook)) and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) * on (namespace) group_left(workspace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")","format":"time_series","hide":false,"instant":false,"interval":"","intervalFactor":2,"legendFormat":"{{notebook}}","legendLink":null,"refId":"C","step":10}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"CPU Usage (by Notebook)","tooltip":{"shared":false,"sort":2,"value_type":"individual"},"transformations":[],"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":4,"format":"percentunit","label":null,"logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"fixed"},"custom":{"align":"center","filterable":false},"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"unit"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":69},"id":89,"options":{"frameIndex":2,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"label_replace(label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") * on(exported_namespace) group_left(workspace) database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")","format":"table","instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"sum(label_replace(kube_pod_container_resource_limits{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"nvidia_com_gpu\", container=~\".+\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"} and on (namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"sum(label_replace(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"nvidia_com_gpu\", container=~\".+\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"} and on (namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"count(label_replace(DCGM_FI_DEV_GPU_UTIL >= 0, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"} and on (namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"},{"exemplar":true,"expr":"count(label_replace(DCGM_FI_DEV_GPU_UTIL == 0, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"} and on (namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, notebook) or clamp_max(absent(count(label_replace(DCGM_FI_DEV_GPU_UTIL == 0, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"} and on (namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, notebook)), 0)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"E"}],"timeFrom":null,"timeShift":null,"title":"GPU Quota (by Notebook)","transformations":[{"id":"merge","options":{}},{"id":"sortBy","options":{"fields":{},"sort":[{"desc":false,"field":"namespace"}]}},{"id":"calculateField","options":{"alias":"Limit","mode":"reduceRow","reduce":{"include":["Value #B"],"reducer":"lastNotNull"}}},{"id":"calculateField","options":{"alias":"Requested","mode":"reduceRow","reduce":{"include":["Value #C"],"reducer":"lastNotNull"}}},{"id":"calculateField","options":{"alias":"gpu_free_temp","mode":"reduceRow","reduce":{"include":["Value #E"],"reducer":"sum"}}},{"id":"calculateField","options":{"alias":"gpu_used_temp","binary":{"left":"Value #D","operator":"-","reducer":"sum","right":"gpu_free_temp"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"calculateField","options":{"alias":"Used","mode":"reduceRow","reduce":{"include":["gpu_used_temp"],"reducer":"max"}}},{"id":"groupBy","options":{"fields":{"Limit":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Requested":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Used":{"aggregations":["last"],"operation":"aggregate"},"gpu_free_temp":{"aggregations":["last"],"operation":"aggregate"},"gpu_used_temp":{"aggregations":["last"],"operation":"aggregate"},"notebook":{"aggregations":[],"operation":"groupby"},"workspace":{"aggregations":["lastNotNull"],"operation":"groupby"}}}},{"id":"organize","options":{"excludeByName":{"gpu_free_temp (last)":true,"gpu_used_temp (last)":true},"indexByName":{"Limit (lastNotNull)":2,"Requested (lastNotNull)":3,"Used (lastNotNull)":4,"notebook":1,"workspace":0},"renameByName":{"Limit (lastNotNull)":"Limits","Requested (lastNotNull)":"Requests","Used (last)":"Used","Used (lastNotNull)":"Used","notebook":"Notebook","workspace":"Workspace"}}}],"type":"table"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"fieldConfig":{"defaults":{"unit":"mbytes"},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":69},"hiddenSeries":false,"id":91,"legend":{"alignAsTable":true,"avg":false,"current":true,"max":false,"min":false,"rightSide":true,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"7.5.17","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"exemplar":true,"expr":"label_replace(DCGM_FI_DEV_FB_USED{namespace=~\"$namespace\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on (notebook) (notebook_info{exported_namespace=~\"$namespace\"} and on (exported_namespace) database_workspace_info{exported_namespace=~\"$namespace\"})","format":"time_series","hide":false,"instant":false,"interval":"","legendFormat":"{{notebook}}/{{kubernetes_node}}/{{gpu}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"GPU Memory Usage (by Notebook)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transformations":[],"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"mbytes","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","displayMode":"auto","filterable":false},"decimals":3,"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[{"matcher":{"id":"byName","options":"Used"},"properties":[{"id":"decimals","value":3}]}]},"gridPos":{"h":8,"w":12,"x":0,"y":77},"id":92,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"frameIndex":1,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"label_replace(label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") * on(exported_namespace) group_left(workspace) database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"kube_pod_container_resource_limits{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container=~\".+\"} and on(container) label_replace(notebook_info, \"container\", \"$1\", \"notebook\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container=~\".+\"} and on(container) label_replace(notebook_info, \"container\", \"$1\", \"notebook\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"container_memory_working_set_bytes{namespace=~\"$namespace\", service=\"kube-prometheus-stack-kubelet\"} and on(container) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"container\", \"$1\", \"notebook\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"}],"title":"Memory Quotas (by Notebook)","transformations":[{"id":"merge","options":{}},{"id":"sortBy","options":{"fields":{},"sort":[{"desc":false,"field":"namespace"}]}},{"id":"groupBy","options":{"fields":{"Value #A":{"aggregations":[],"operation":null},"Value #B":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #C":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #D":{"aggregations":["lastNotNull"],"operation":"aggregate"},"name":{"aggregations":["lastNotNull"],"operation":null},"namespace":{"aggregations":["lastNotNull"],"operation":null},"node":{"aggregations":["lastNotNull"],"operation":"aggregate"},"notebook":{"aggregations":["lastNotNull"],"operation":"aggregate"},"pod":{"aggregations":[],"operation":"groupby"},"workspace":{"aggregations":["lastNotNull"],"operation":"aggregate"}}}},{"id":"filterByValue","options":{"filters":[{"config":{"id":"isNull","options":{}},"fieldName":"notebook (lastNotNull)"}],"match":"any","type":"exclude"}},{"id":"organize","options":{"excludeByName":{"node (lastNotNull)":true,"pod":true,"workspace (lastNotNull)":false},"indexByName":{"Value #B (lastNotNull)":3,"Value #C (lastNotNull)":4,"Value #D (lastNotNull)":5,"node (lastNotNull)":2,"notebook (lastNotNull)":1,"pod":6,"workspace (lastNotNull)":0},"renameByName":{"Value #B (lastNotNull)":"Limits","Value #C (lastNotNull)":"Requests","Value #D (lastNotNull)":"Used","name (lastNotNull)":"워크스페이스","node (lastNotNull)":"Node","notebook (lastNotNull)":"Notebook","workspace (lastNotNull)":"Workspace"}}}],"type":"table"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"description":"","fieldConfig":{"defaults":{"unit":"percent"},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":77},"hiddenSeries":false,"id":94,"interval":"1m","legend":{"alignAsTable":true,"avg":false,"current":true,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"alertThreshold":true},"percentage":true,"pluginVersion":"7.5.17","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"capacity","color":"#F2495C","dashes":true,"fill":0,"hiddenSeries":true,"hideTooltip":true,"legend":true,"linewidth":1,"stack":false},{"alias":"/^(ns-).[0-9]*/","fill":1,"stack":true}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"((sum(label_replace(container_memory_working_set_bytes{namespace=~\"$namespace\", container=~\".+\", service=\"kube-prometheus-stack-kubelet\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"}) by (namespace, notebook) / sum(label_replace(kube_pod_container_resource_limits{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container=~\".+\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"}) by (namespace, notebook)) and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) * on (namespace) group_left(workspace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")","hide":false,"interval":"","legendFormat":"{{notebook}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Memory Usage (by Notebook)","tooltip":{"shared":false,"sort":2,"value_type":"individual"},"transformations":[],"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":4,"format":"percent","label":null,"logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","displayMode":"auto","filterable":false},"decimals":3,"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"bytes"},"overrides":[{"matcher":{"id":"byName","options":"Volume"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"","to":"","type":1,"value":"NONE"}]}]}]},"gridPos":{"h":8,"w":12,"x":0,"y":85},"id":96,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"frameIndex":2,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(label_replace(label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") * on(exported_namespace) group_left(workspace) database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, workspace, notebook, persistentvolumeclaim)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"sum(kube_persistentvolume_capacity_bytes{job=\"gpu-metrics\"} * on (persistentvolume) group_left(namespace, persistentvolumeclaim) label_replace(kube_persistentvolumeclaim_info{job=\"gpu-metrics\", namespace=~\"$namespace\"}, \"persistentvolume\", \"$1\", \"volumename\", \"(.+)\") * on(namespace) group_left(workspace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (workspace, namespace, persistentvolume, persistentvolumeclaim)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"sum(label_replace(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"} and on (claim_namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\") and on (persistentvolume) kube_persistentvolume_info{job=\"gpu-metrics\", storageclass=~\"longhorn|longhorn-static\"}, \"persistentvolumeclaim\", \"$1\", \"name\", \"(.+)\") * on(claim_namespace) group_left(workspace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (workspace, persistentvolumeclaim)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"}],"title":"Storage Quotas (by Volume)","transformations":[{"id":"merge","options":{}},{"id":"organize","options":{"excludeByName":{"Time":true,"Value #A":true,"namespace":true,"persistentvolume":true},"indexByName":{"Time":3,"Value #A":5,"Value #B":7,"Value #C":8,"namespace":4,"notebook":1,"persistentvolume":6,"persistentvolumeclaim":2,"workspace":0},"renameByName":{"Time":"","Value #B":"Capacity","Value #C":"Used","notebook":"Notebook","persistentvolumeclaim":"Volume","workspace":"Workspace"}}}],"type":"table"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":null,"description":"","fieldConfig":{"defaults":{"unit":"percent"},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":85},"hiddenSeries":false,"id":112,"interval":"1m","legend":{"alignAsTable":true,"avg":false,"current":true,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null as zero","options":{"alertThreshold":true},"percentage":true,"pluginVersion":"7.5.17","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"capacity","color":"#F2495C","dashes":true,"fill":0,"hiddenSeries":true,"hideTooltip":true,"legend":true,"linewidth":1,"stack":false},{"alias":"/^(ns-).[0-9]*/","fill":1,"stack":true}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"exemplar":true,"expr":"label_replace(longhorn_volume_actual_size_bytes / longhorn_volume_capacity_bytes * 100, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) (kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"} and on(claim_namespace) label_replace(database_workspace_info, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))","hide":false,"interval":"","legendFormat":"{{name}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Storage Usage (by Volume)","tooltip":{"shared":false,"sort":2,"value_type":"individual"},"transformations":[],"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":4,"format":"percent","label":null,"logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":false}],"yaxis":{"align":false,"alignLevel":null}}],"title":"Workspace Details [ Workspace : $workspace ]","type":"row"}],"refresh":"5s","schemaVersion":27,"style":"dark","tags":[],"templating":{"list":[{"allValue":".+","current":{"selected":true,"text":["All"],"value":["$__all"]},"datasource":null,"definition":"label_values(kube_node_info{job=\"gpu-metrics\"}, node)","description":null,"error":null,"hide":0,"includeAll":true,"label":null,"multi":true,"name":"node","options":[],"query":{"query":"label_values(kube_node_info{job=\"gpu-metrics\"}, node)","refId":"StandardVariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":"'.*'","current":{"selected":true,"text":["All"],"value":["$__all"]},"datasource":"PostgreSQL","definition":"select name\nfrom haiqv_workspace","description":null,"error":null,"hide":0,"includeAll":true,"label":null,"multi":true,"name":"workspace","options":[],"query":"select name\nfrom haiqv_workspace","refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"selected":false,"text":"^.*$","value":"^.*$"},"datasource":"PostgreSQL","definition":"select concat('^', concat_ws('$|^', $workspace), '$')","description":null,"error":null,"hide":2,"includeAll":false,"label":null,"multi":false,"name":"workspace_regex","options":[{"selected":true,"text":"^.*$","value":"^.*$"}],"query":"select concat('^', concat_ws('$|^', $workspace), '$')","refresh":0,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"selected":false,"text":".*","value":".*"},"datasource":"PostgreSQL","definition":"select string_agg(t1.namespace, '|') as namespace\nfrom (\n\tselect distinct\n\tcase\n\twhen '$workspace_regex' = '^.*$' then '.*'\n\telse concat('ns-', id)\n\tend as namespace\n\tfrom haiqv_workspace\n\twhere name ~ '$workspace_regex'\n) as t1","description":null,"error":null,"hide":2,"includeAll":false,"label":null,"multi":false,"name":"namespace","options":[{"selected":true,"text":".*","value":".*"}],"query":"select string_agg(t1.namespace, '|') as namespace\nfrom (\n\tselect distinct\n\tcase\n\twhen '$workspace_regex' = '^.*$' then '.*'\n\telse concat('ns-', id)\n\tend as namespace\n\tfrom haiqv_workspace\n\twhere name ~ '$workspace_regex'\n) as t1","refresh":0,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"description":null,"error":null,"hide":2,"label":null,"name":"buffer_factor","query":"1.1","skipUrlSync":false,"type":"constant"}]},"time":{"from":"now-3h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","15s","20s","30s","1m","5m","15m","30m","1h","2h","1d"]},"timezone":"","title":"Cluster","uid":"9h8SeV1Vz","version":1}
  modal.json: |-
    {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":false,"gnetId":null,"graphTooltip":0,"id":180,"iteration":1678082049820,"links":[],"panels":[{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","displayMode":"auto","filterable":false},"decimals":3,"mappings":[],"thresholds":{"mode":"percentage","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"none"},"overrides":[{"matcher":{"id":"byName","options":"CPU"},"properties":[{"id":"unit","value":"core"}]},{"matcher":{"id":"byName","options":"GPU"},"properties":[{"id":"unit","value":"unit"},{"id":"decimals","value":0},{"id":"custom.width","value":null}]},{"matcher":{"id":"byName","options":"Memory"},"properties":[{"id":"unit","value":"bytes"}]},{"matcher":{"id":"byName","options":"Storage"},"properties":[{"id":"unit","value":"bytes"}]}]},"gridPos":{"h":3,"w":9,"x":0,"y":0},"id":155,"options":{"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"(sum(kube_node_status_allocatable{job=\"gpu-metrics\", resource=\"cpu\"}) - sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"ns-.*\", resource=\"cpu\", type=\"hard\"} or clamp_max(absent(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"ns-.*\", resource=\"cpu\", type=\"hard\"}), 0))) * 1/$buffer_factor","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"(sum(kube_node_status_allocatable{job=\"gpu-metrics\", resource=\"nvidia_com_gpu\"}) or clamp_max(absent(kube_node_status_allocatable{job=\"gpu-metrics\", resource=\"nvidia_com_gpu\"}), 0)) - scalar(sum(kube_resourcequota{job=\"gpu-metrics\", resource=\"requests.nvidia.com/gpu\", type=\"hard\"}) or clamp_max(absent(kube_resourcequota{job=\"gpu-metrics\", resource=\"requests.nvidia.com/gpu\", type=\"hard\"}), 0))","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"(sum(kube_node_status_allocatable{job=\"gpu-metrics\", resource=\"memory\"}) - sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"ns-.*\", resource=\"memory\", type=\"hard\"} or clamp_max(absent(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"ns-.*\", resource=\"memory\", type=\"hard\"}), 0))) * 1/$buffer_factor","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"((sum(kube_node_status_capacity{job=\"gpu-metrics\", resource=\"ephemeral_storage\"}) OR clamp_max(absent(kube_node_status_capacity{job=\"gpu-metrics\", resource=\"ephemeral_storage\"}), 0))\n- \n((sum(storage_node_disk_scheduled_bytes) or clamp_max(absent(storage_node_disk_scheduled_bytes),0)) + (sum(longhorn_node_storage_reservation_bytes) or clamp_max(absent(longhorn_node_storage_reservation_bytes), 0)))) / $longhorn_replica_count","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"}],"timeFrom":null,"timeShift":null,"transformations":[{"id":"merge","options":{}},{"id":"organize","options":{"excludeByName":{"Time":true},"indexByName":{},"renameByName":{"Value #A":"CPU","Value #B":"GPU","Value #C":"Memory","Value #D":"Storage"}}}],"type":"table"}],"refresh":"5s","schemaVersion":27,"style":"dark","tags":[],"templating":{"list":[{"description":null,"error":null,"hide":2,"label":null,"name":"buffer_factor","query":"1.1","skipUrlSync":false,"type":"constant"},{"description":null,"error":null,"hide":2,"label":null,"name":"longhorn_replica_count","query":"2","skipUrlSync":false,"type":"constant"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"]},"timezone":"","title":"Modal","uid":"29KRXch4z","version":1}
  notebook.json: |-
    {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":false,"gnetId":null,"graphTooltip":0,"id":181,"iteration":1678082126799,"links":[],"panels":[{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","filterable":false},"decimals":1,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"percentunit"},"overrides":[{"matcher":{"id":"byName","options":"Value #A"},"properties":[{"id":"custom.displayMode","value":"lcd-gauge"},{"id":"custom.width","value":150}]},{"matcher":{"id":"byName","options":"Value #B"},"properties":[{"id":"custom.displayMode","value":"lcd-gauge"},{"id":"mappings","value":[{"from":"","id":1,"text":"-","to":"","type":1,"value":"-1"}]},{"id":"custom.width","value":150}]},{"matcher":{"id":"byName","options":"Value #C"},"properties":[{"id":"custom.displayMode","value":"lcd-gauge"},{"id":"custom.width","value":150}]},{"matcher":{"id":"byName","options":"value_1"},"properties":[{"id":"custom.width","value":45}]},{"matcher":{"id":"byName","options":"value_2"},"properties":[{"id":"custom.width","value":45}]},{"matcher":{"id":"byName","options":"value_3"},"properties":[{"id":"custom.width","value":45}]}]},"gridPos":{"h":2,"w":9,"x":0,"y":0},"id":104,"options":{"frameIndex":2,"showHeader":false,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container=~\"$notebook\"}) by (namespace, container)\n/\nsum(kube_pod_container_resource_limits{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container=~\"$notebook\"}) by (namespace, container)","format":"table","instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"((count(DCGM_FI_DEV_GPU_UTIL{namespace=~\"$namespace\", container=~\"$notebook\"} >= 0) by (namespace, container) or clamp_max(absent(_{namespace=\"$namespace\", container=\"$notebook\"}), 0))\n-\n(count(DCGM_FI_DEV_GPU_UTIL{namespace=~\"$namespace\", container=~\"$notebook\"} == 0) by (namespace, container) or clamp_max(absent(_{namespace=\"$namespace\", container=\"$notebook\"}), 0)))\n/\nsum(kube_pod_container_resource_limits{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"nvidia_com_gpu\", container=~\"$notebook\"} > 0) by (namespace, container)  or clamp_max(absent(_{namespace=\"$namespace\", container=\"$notebook\"}), -1)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"sum(container_memory_working_set_bytes{namespace=~\"$namespace\", service=\"kube-prometheus-stack-kubelet\", container=~\"$notebook\"}) by (namespace, container)\n/\nsum(kube_pod_container_resource_limits{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container=~\"$notebook\"}) by (namespace, container)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"clamp_max(absent(_{namespace=\"$namespace\", container=\"$notebook\", value_1=\"CPU\", value_2=\"GPU\", value_3=\"MEM\"}), 0)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"}],"transformations":[{"id":"merge","options":{}},{"id":"organize","options":{"excludeByName":{"Time":true,"Value #D":true,"container":true,"namespace":true},"indexByName":{"Time":0,"Value #A":4,"Value #B":6,"Value #C":8,"Value #D":9,"container":1,"namespace":2,"value_1":3,"value_2":5,"value_3":7},"renameByName":{}}}],"type":"table"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","filterable":false},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"CPU"},"properties":[{"id":"unit","value":"core"}]},{"matcher":{"id":"byName","options":"GPU"},"properties":[{"id":"unit","value":"unit"},{"id":"decimals","value":0},{"id":"custom.width","value":null}]},{"matcher":{"id":"byName","options":"Memory"},"properties":[{"id":"unit","value":"bytes"}]},{"matcher":{"id":"byName","options":"Storage"},"properties":[{"id":"unit","value":"bytes"}]}]},"gridPos":{"h":2,"w":9,"x":0,"y":2},"id":102,"options":{"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"(sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", type=\"hard\"}) * 1/$buffer_factor)\n-\n((sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container!='istio-proxy'} and on (pod) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)) or clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container!='istio-proxy'} and on (pod) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)), 0))\n+\n(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container='tensorboard'} and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)) or clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container='tensorboard'} and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)), 0)))","format":"table","instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=\"$namespace\", resource=\"requests.nvidia.com/gpu\", type=\"hard\"}) - sum(kube_resourcequota{job=\"gpu-metrics\", namespace=\"$namespace\", resource=\"requests.nvidia.com/gpu\", type=\"used\"})","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"(sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", type=\"hard\"}) * 1/$buffer_factor)\n-\n((sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container!='istio-proxy'} and on (pod) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)) or clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container!='istio-proxy'} and on (pod) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)), 0))\n+\n(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container='tensorboard'} and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)) or clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container='tensorboard'} and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)), 0)))","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=\"$namespace\", resource=\"requests.storage\", type=\"hard\"}) - sum(kube_resourcequota{job=\"gpu-metrics\", namespace=\"$namespace\", resource=\"requests.storage\", type=\"used\"})","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"}],"transformations":[{"id":"merge","options":{}},{"id":"organize","options":{"excludeByName":{"Time":true},"indexByName":{},"renameByName":{"Value #A":"CPU","Value #B":"GPU","Value #C":"Memory","Value #D":"Storage"}}}],"type":"table"}],"refresh":"5s","schemaVersion":27,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{"selected":true,"text":"ns-31","value":"ns-31"},"datasource":"PostgreSQL","definition":"select concat('ns-', id) as namespace\nfrom haiqv_workspace","description":null,"error":null,"hide":0,"includeAll":false,"label":null,"multi":false,"name":"namespace","options":[],"query":"select concat('ns-', id) as namespace\nfrom haiqv_workspace","refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"description":null,"error":null,"hide":2,"label":null,"name":"buffer_factor","query":"1.1","skipUrlSync":false,"type":"constant"},{"allValue":".+","current":{"selected":true,"text":"custom-ziippy-inferencer","value":"custom-ziippy-inferencer"},"datasource":null,"definition":"label_values(notebook_info{exported_namespace=~\"$namespace\"}, notebook)","description":null,"error":null,"hide":0,"includeAll":true,"label":null,"multi":false,"name":"notebook","options":[{"selected":false,"text":"All","value":"$__all"},{"selected":true,"text":"custom-ziippy-inferencer","value":"custom-ziippy-inferencer"}],"query":{"query":"label_values(notebook_info{exported_namespace=~\"$namespace\"}, notebook)","refId":"StandardVariableQuery"},"refresh":0,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-10m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","10m","15m","30m","1h","2h","1d"]},"timezone":"","title":"Notebook","uid":"lhNp6V1Vk","version":1}
  workspace.json: |-
    {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":false,"gnetId":null,"graphTooltip":0,"id":214,"iteration":1678082354550,"links":[],"panels":[{"datasource":null,"fieldConfig":{"defaults":{},"overrides":[]},"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":46,"options":{"activeTheme":"Embed","disableThemePicker":true,"themes":[{"name":"Embed","styles":[{"props":{"theme":"light"},"type":"basetheme"},{"props":{"url":""},"type":"bgimage"},{"props":{"url":""},"type":"url"},{"props":{"text":".panel-container {\n  background-color: #FFFFFF;\n}\n.dashboard-container {\n  background-color: #FFFFFF; \n}\n.navbar {\n  background-color: #FFFFFF;\n}\n.sidemenu {\n  box-shadow: none;\n  -webkit-box-shadow: none;\n}\ndiv.panel-header.grid-drag-handle {\n  pointer-events: none;\n}\ndiv.css-1bpq4j8 {\n  display: none;\n  pointer-events: none;\n}\ndiv.panel-title > div.css-1vzus6i-Icon {\n  display: none;\n  pointer-events: none;\n}\ndiv#panel-46 {\n  visibility: hidden;\n}\ndiv.css-kzwnou-filterWrapper.cell-filter-actions  {\n  display: none !important;\n  pointer-events: !important;\n}\ndiv#panel-77, div#panel-78, div#panel-79, div#panel-80 {\n  pointer-events: none;\n}"},"type":"style"},{"props":{"color":""},"type":"panel-container-bg-color"}]}]},"pluginVersion":"0.2.1","timeFrom":null,"timeShift":null,"type":"yesoreyeram-boomtheme-panel"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":0,"y":1},"id":77,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container!~\"istio.*\", container=~\".+\"} OR clamp_max(absent(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container!~\"istio.*\", container=~\".+\"}), 0))\n/\n(sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", type=\"hard\"}) * 1/$buffer_factor) * 100","hide":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"CPU Usage","type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":3,"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":6,"y":1},"id":78,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"scalar(count(DCGM_FI_DEV_GPU_UTIL{namespace=~\"$namespace\"} > 0) or clamp_max(absent(DCGM_FI_DEV_GPU_UTIL{namespace=~\"$namespace\"} > 0), 0)) / scalar(sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.nvidia.com/gpu\", type=\"hard\"} > 0)) * 100","hide":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"GPU Usage","type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":12,"y":1},"id":79,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(container_memory_working_set_bytes{namespace=~\"$namespace\", container!~\"istio.*\", service=\"kube-prometheus-stack-kubelet\"} OR clamp_max(absent(container_memory_working_set_bytes{namespace=~\"$namespace\", container!~\"istio.*\", service=\"kube-prometheus-stack-kubelet\"}), 0))\n/\n(sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", type=\"hard\"} > 0) * 1/$buffer_factor) * 100","hide":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Memory Usage","type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":3,"w":6,"x":18,"y":1},"id":80,"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"(sum(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) (kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"} and on(claim_namespace) label_replace(database_workspace_info, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))) OR clamp_max(absent(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) (kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"} and on(claim_namespace) label_replace(database_workspace_info, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))), 0)) / (sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.storage\", type=\"hard\"} > 0)) * 100","hide":false,"interval":"","legendFormat":"","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Storage Usage","type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(255, 255, 255)","mode":"fixed"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"core"},"overrides":[{"matcher":{"id":"byName","options":"Available"},"properties":[{"id":"color"}]}]},"gridPos":{"h":5,"w":6,"x":0,"y":4},"id":50,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"titleSize":15,"valueSize":16},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", type=\"hard\"}) * 1/$buffer_factor","instant":false,"interval":"","legendFormat":"Limits","refId":"A"},{"exemplar":true,"expr":"(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container!='istio-proxy'} and on (pod) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)) or clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container!='istio-proxy'} and on (pod) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)), 0))\n+\n(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container='tensorboard'} and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)) or clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container='tensorboard'} and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)), 0))","hide":false,"interval":"","legendFormat":"Requests","refId":"B"},{"exemplar":true,"expr":"sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container!~\"istio.*\", container=~\".+\"} OR clamp_max(absent(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container!~\"istio.*\", container=~\".+\"}), 0))","hide":false,"interval":"","legendFormat":"Used","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"CPU Quota","transformations":[{"id":"calculateField","options":{"alias":"Available","binary":{"left":"Limits","operator":"-","reducer":"sum","right":"Requests"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"organize","options":{"excludeByName":{"istio_requests_cpu":true,"notebook_istio":true,"resourcequota_used":false,"tensorboard_istio":true},"indexByName":{"Available":0,"Limits":2,"Requests":3,"Time":1,"Used":4},"renameByName":{}}}],"type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(255, 255, 255)","mode":"fixed"},"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"unit"},"overrides":[{"matcher":{"id":"byName","options":"Available"},"properties":[{"id":"color"}]}]},"gridPos":{"h":5,"w":6,"x":6,"y":4},"id":54,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"titleSize":15,"valueSize":16},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.nvidia.com/gpu\", type=\"hard\"})","instant":false,"interval":"","legendFormat":"Limits","refId":"A"},{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.nvidia.com/gpu\", type=\"used\"})","hide":false,"interval":"","legendFormat":"Requests","refId":"B"},{"exemplar":true,"expr":"count(DCGM_FI_DEV_GPU_UTIL{namespace=~\"$namespace\"} > 0) or clamp_max(absent(DCGM_FI_DEV_GPU_UTIL{namespace=~\"$namespace\"} > 0), 0)","hide":false,"interval":"","legendFormat":"Used","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"GPU Quota","transformations":[{"id":"calculateField","options":{"alias":"Available","binary":{"left":"Limits","operator":"-","reducer":"sum","right":"Requests"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"organize","options":{"excludeByName":{},"indexByName":{"Available":0,"Limits":2,"Requests":3,"Time":1,"Used":4},"renameByName":{}}}],"type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(255, 255, 255)","mode":"fixed"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"bytes"},"overrides":[{"matcher":{"id":"byName","options":"Available"},"properties":[{"id":"color"}]}]},"gridPos":{"h":5,"w":6,"x":12,"y":4},"id":58,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"titleSize":15,"valueSize":16},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", type=\"hard\"}) * 1/$buffer_factor","instant":false,"interval":"","legendFormat":"Limits","refId":"A"},{"exemplar":true,"expr":"(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container!='istio-proxy'} and on (pod) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)) or clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container!='istio-proxy'} and on (pod) label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)), 0))\n+\n(sum(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container='tensorboard'} and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)) or clamp_max(absent(kube_pod_container_resource_requests{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container='tensorboard'} and on(pod) (kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\",phase=\"Running\"} == 1)), 0))","hide":false,"interval":"","legendFormat":"Requests","refId":"B"},{"exemplar":true,"expr":"sum(container_memory_working_set_bytes{namespace=~\"$namespace\", container!~\"istio.*\", service=\"kube-prometheus-stack-kubelet\"} OR clamp_max(absent(container_memory_working_set_bytes{namespace=~\"$namespace\", container!~\"istio.*\", service=\"kube-prometheus-stack-kubelet\"}), 0))","hide":false,"interval":"","legendFormat":"Used","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"Memory Quota","transformations":[{"id":"calculateField","options":{"alias":"Available","binary":{"left":"Limits","operator":"-","reducer":"sum","right":"Requests"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"organize","options":{"excludeByName":{"istio_requests_memory":true,"notebook_istio":false,"resourcequota_used":true,"tensorboard_istio":false},"indexByName":{"Available":1,"Limits":2,"Requests":3,"Time":0,"Used":4},"renameByName":{}}}],"type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"fixedColor":"rgb(255, 255, 255)","mode":"fixed"},"decimals":3,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":"bytes"},"overrides":[{"matcher":{"id":"byName","options":"Available"},"properties":[{"id":"color"}]}]},"gridPos":{"h":5,"w":6,"x":18,"y":4},"id":62,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"horizontal","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"text":{"titleSize":15,"valueSize":16},"textMode":"auto"},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.storage\", type=\"hard\"})","instant":false,"interval":"","legendFormat":"Limits","refId":"A"},{"exemplar":true,"expr":"sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.storage\", type=\"used\"})","hide":false,"interval":"","legendFormat":"Requests","refId":"B"},{"exemplar":true,"expr":"sum(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) (kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"} and on(claim_namespace) label_replace(database_workspace_info, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))) OR clamp_max(absent(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) (kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"} and on(claim_namespace) label_replace(database_workspace_info, \"claim_namespace\", \"$1\", \"exported_namespace\", \"(.+)\"))), 0)","hide":false,"interval":"","legendFormat":"Used","refId":"C"}],"timeFrom":null,"timeShift":null,"title":"Storage Quota","transformations":[{"id":"calculateField","options":{"alias":"Available","binary":{"left":"Limits","operator":"-","reducer":"sum","right":"Requests"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"organize","options":{"excludeByName":{},"indexByName":{"Available":0,"Limits":2,"Requests":3,"Time":1,"Used":4},"renameByName":{}}}],"type":"stat"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","displayMode":"auto","filterable":false},"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"GPU Utilization"},"properties":[{"id":"custom.displayMode","value":"lcd-gauge"},{"id":"unit","value":"percent"}]},{"matcher":{"id":"byName","options":"Memory Utilization"},"properties":[{"id":"custom.displayMode","value":"lcd-gauge"},{"id":"unit","value":"percent"}]},{"matcher":{"id":"byName","options":"Memory Usage"},"properties":[{"id":"custom.displayMode","value":"lcd-gauge"},{"id":"unit","value":"percent"}]},{"matcher":{"id":"byName","options":"Temp"},"properties":[{"id":"unit","value":"celsius"},{"id":"custom.width","value":81}]},{"matcher":{"id":"byName","options":"Power"},"properties":[{"id":"unit","value":"watt"},{"id":"custom.width","value":84}]},{"matcher":{"id":"byName","options":"Index"},"properties":[{"id":"custom.width","value":80}]},{"matcher":{"id":"byName","options":"Node"},"properties":[{"id":"custom.width","value":139}]},{"matcher":{"id":"byName","options":"Status"},"properties":[{"id":"custom.width","value":88}]},{"matcher":{"id":"byName","options":"Status"},"properties":[{"id":"custom.displayMode","value":"color-background"},{"id":"mappings","value":[{"from":"","id":1,"text":"Running","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"Ready","to":"","type":1,"value":"0"}]},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null},{"color":"yellow","value":0},{"color":"green","value":1}]}}]}]},"gridPos":{"h":10,"w":24,"x":0,"y":9},"id":65,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"frameIndex":2,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"sum(label_replace(notebook_info * on(exported_namespace) group_left(workspace) database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, workspace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"sum(label_replace(DCGM_FI_DEV_GPU_UTIL{kubernetes_node=~\"$node\", namespace=~\"$namespace\"}, \"notebook\", \"$1\", \"container\", \"(.+)\")) by(UUID, kubernetes_node, gpu, modelName, namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"sum(label_replace(DCGM_FI_DEV_MEM_COPY_UTIL{kubernetes_node=~\"$node\", namespace=~\"$namespace\"}, \"notebook\", \"$1\", \"container\", \"(.+)\")) by(UUID, kubernetes_node, gpu, modelName, namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"sum(label_replace(DCGM_FI_DEV_FB_USED{kubernetes_node=~\"$node\", namespace=~\"$namespace\"} / (DCGM_FI_DEV_FB_FREE{kubernetes_node=~\"$node\", namespace=~\"$namespace\"} + DCGM_FI_DEV_FB_USED{kubernetes_node=~\"$node\", namespace=~\"$namespace\"}) * 100, \"notebook\", \"$1\", \"container\", \"(.+)\")) by(UUID, kubernetes_node, gpu, modelName, namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"},{"exemplar":true,"expr":"sum(label_replace(DCGM_FI_DEV_GPU_TEMP{kubernetes_node=~\"$node\", namespace=~\"$namespace\"}, \"notebook\", \"$1\", \"container\", \"(.+)\")) by(UUID, kubernetes_node, gpu, modelName, namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"E"},{"exemplar":true,"expr":"sum(label_replace(DCGM_FI_DEV_POWER_USAGE{kubernetes_node=~\"$node\", namespace=~\"$namespace\"}, \"notebook\", \"$1\", \"container\", \"(.+)\")) by(UUID, kubernetes_node, gpu, modelName, namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"F"}],"title":"GPU Status","transformations":[{"id":"merge","options":{}},{"id":"groupBy","options":{"fields":{"Status":{"aggregations":["lastNotNull"],"operation":"aggregate"},"UUID":{"aggregations":[],"operation":"groupby"},"Value #A":{"aggregations":["lastNotNull"],"operation":null},"Value #B":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #C":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #D":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #E":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #F":{"aggregations":["lastNotNull"],"operation":"aggregate"},"gpu":{"aggregations":["lastNotNull"],"operation":"aggregate"},"kubernetes_node":{"aggregations":["lastNotNull"],"operation":"aggregate"},"modelName":{"aggregations":["lastNotNull"],"operation":"aggregate"},"notebook":{"aggregations":["lastNotNull"],"operation":"aggregate"},"workspace":{"aggregations":["lastNotNull"],"operation":"aggregate"}}}},{"id":"filterByValue","options":{"filters":[{"config":{"id":"isNull","options":{}},"fieldName":"Value #E (lastNotNull)"},{"config":{"id":"isNull","options":{}},"fieldName":"Value #F (lastNotNull)"}],"match":"all","type":"exclude"}},{"id":"sortBy","options":{"fields":{},"sort":[{"desc":false,"field":"kubernetes_node (lastNotNull)"}]}},{"id":"organize","options":{"excludeByName":{"UUID":true},"indexByName":{"Status (lastNotNull)":3,"UUID":11,"Value #B (lastNotNull)":8,"Value #C (lastNotNull)":9,"Value #D (lastNotNull)":10,"Value #E (lastNotNull)":6,"Value #F (lastNotNull)":7,"gpu (lastNotNull)":1,"kubernetes_node (lastNotNull)":0,"modelName (lastNotNull)":2,"notebook (lastNotNull)":5,"workspace (lastNotNull)":4},"renameByName":{"Status (lastNotNull)":"Status","UUID":"","Value #B (lastNotNull)":"GPU Utilization","Value #C (lastNotNull)":"Memory Utilization","Value #D (lastNotNull)":"Memory Usage","Value #E (lastNotNull)":"Temp","Value #F (lastNotNull)":"Power","gpu (lastNotNull)":"Index","kubernetes_node (lastNotNull)":"Node","modelName (lastNotNull)":"Model","notebook (lastNotNull)":"Notebook","workspace (lastNotNull)":"Workspace"}}}],"type":"table"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","filterable":false},"mappings":[],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.4},{"color":"orange","value":0.6},{"color":"red","value":0.8}]}},"overrides":[{"matcher":{"id":"byName","options":"Status"},"properties":[{"id":"noValue","value":"Stopped"},{"id":"mappings","value":[{"from":"","id":1,"text":"Failed","to":"","type":1,"value":"0"},{"from":"","id":2,"text":"Running","to":"","type":1,"value":"1"},{"from":"","id":3,"text":"Pending","to":"","type":1,"value":"2"},{"from":"","id":4,"text":"Succeeded","to":"","type":1,"value":"3"},{"from":"","id":5,"text":"Unknown","to":"","type":1,"value":"4"}]},{"id":"custom.displayMode","value":"color-background"},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"yellow","value":null},{"color":"green","value":1},{"color":"orange","value":2},{"color":"green","value":3},{"color":"yellow","value":4}]}},{"id":"custom.width","value":100}]},{"matcher":{"id":"byName","options":"GPU Limit"},"properties":[{"id":"unit","value":"unit"},{"id":"custom.width","value":110}]},{"matcher":{"id":"byName","options":"GPU Used"},"properties":[{"id":"unit","value":"unit"},{"id":"custom.width","value":110}]},{"matcher":{"id":"byName","options":"CPU Usage"},"properties":[{"id":"unit","value":"percentunit"},{"id":"custom.displayMode","value":"basic"},{"id":"decimals","value":2}]},{"matcher":{"id":"byName","options":"GPU Usage"},"properties":[{"id":"unit","value":"percentunit"},{"id":"custom.displayMode","value":"basic"}]},{"matcher":{"id":"byName","options":"Memory Usage"},"properties":[{"id":"unit","value":"percentunit"},{"id":"custom.displayMode","value":"basic"},{"id":"decimals","value":2}]},{"matcher":{"id":"byName","options":"Mounted Volumes"},"properties":[{"id":"custom.width","value":160}]},{"matcher":{"id":"byName","options":"Workspace"},"properties":[{"id":"custom.width","value":232}]},{"matcher":{"id":"byName","options":"namespace"},"properties":[{"id":"custom.width","value":null}]}]},"gridPos":{"h":10,"w":24,"x":0,"y":19},"id":73,"options":{"frameIndex":1,"showHeader":true,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"label_replace(label_replace(label_replace((label_replace(label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\"), \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\") * on (namespace, pod) group_left(Status) (label_replace(label_replace(label_replace(label_replace(label_replace(kube_pod_status_phase{job=\"gpu-metrics\", namespace=~\"$namespace\"}, \"Status\", \"0\", \"phase\", \"Failed\"), \"Status\", \"1\", \"phase\", \"Running\"), \"Status\", \"2\", \"phase\", \"Pending\"), \"Status\", \"3\", \"phase\", \"Succeeded\"), \"Status\", \"4\", \"phase\", \"Unknown\") == 1)) * on(exported_namespace) group_left(name) database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\"), \"pod\", \"$1\", \"exported_pod\", \"(.+)\"), \"workspace\", \"$1\", \"name\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"label_replace(label_replace(label_replace(label_replace(notebook_info{exported_namespace=~\"$namespace\"}, \"pod\", \"$1\", \"exported_pod\", \"(.+)\") * on(exported_namespace) group_left(name) database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\"), \"pod\", \"$1\", \"exported_pod\", \"(.+)\"), \"workspace\", \"$1\", \"name\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"(sum(label_replace(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container=~\".+\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"}) by (namespace, notebook) / sum(label_replace(kube_pod_container_resource_limits{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", container=~\".+\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"}) by (namespace, notebook)) and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"count(label_replace(DCGM_FI_DEV_GPU_UTIL >= 0, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"} and on (namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"},{"exemplar":true,"expr":"count(label_replace(DCGM_FI_DEV_GPU_UTIL == 0, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"} and on (namespace) label_replace(database_workspace_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"E"},{"exemplar":true,"expr":"(sum(label_replace(container_memory_working_set_bytes{namespace=~\"$namespace\", service=\"kube-prometheus-stack-kubelet\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"}) by (namespace, notebook) / sum(label_replace(kube_pod_container_resource_limits{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", container=~\".+\"}, \"notebook\", \"$1\", \"container\", \"(.+)\") and on(notebook) notebook_info{exported_namespace=~\"$namespace\"}) by (namespace, notebook)) and on(namespace) label_replace(database_workspace_info, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"F"},{"exemplar":true,"expr":"sum(notebook_info{persistentvolumeclaim!=\"NONE\"} and on (exported_namespace) database_workspace_info{exported_namespace=~\"$namespace\"}) by (notebook)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"G"},{"exemplar":true,"expr":"sum(label_replace(database_workspace_info{exported_namespace=~\"$namespace\"} and on(exported_namespace) notebook_info{exported_namespace=~\"$namespace\"}, \"namespace\", \"$1\", \"exported_namespace\", \"(.+)\")) by (namespace, workspace)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"H"}],"timeFrom":null,"timeShift":null,"title":"Notebook Status","transformations":[{"id":"merge","options":{}},{"id":"calculateField","options":{"alias":"gpu_free_temp","mode":"reduceRow","reduce":{"include":["Value #E"],"reducer":"sum"}}},{"id":"calculateField","options":{"alias":"gpu_used_temp","binary":{"left":"Value #D","operator":"-","reducer":"sum","right":"gpu_free_temp"},"mode":"binary","reduce":{"include":[],"reducer":"diff"}}},{"id":"calculateField","options":{"alias":"GPU Used","mode":"reduceRow","reduce":{"include":["gpu_used_temp"],"reducer":"max"}}},{"id":"calculateField","options":{"alias":"gpu_usage_temp","binary":{"left":"GPU Used","operator":"/","reducer":"sum","right":"Value #D"},"mode":"binary","reduce":{"reducer":"sum"}}},{"id":"calculateField","options":{"alias":"GPU Usage","mode":"reduceRow","reduce":{"include":["gpu_usage_temp"],"reducer":"max"}}},{"id":"sortBy","options":{"fields":{},"sort":[{"desc":false,"field":"namespace"}]}},{"id":"groupBy","options":{"fields":{"GPU Usage":{"aggregations":["last"],"operation":"aggregate"},"GPU Used":{"aggregations":["last"],"operation":"aggregate"},"Status":{"aggregations":[],"operation":"groupby"},"Value #C":{"aggregations":["last"],"operation":"aggregate"},"Value #D":{"aggregations":["last"],"operation":"aggregate"},"Value #E":{"aggregations":["lastNotNull"],"operation":null},"Value #F":{"aggregations":["last"],"operation":"aggregate"},"Value #G":{"aggregations":["last"],"operation":"aggregate"},"namespace":{"aggregations":[],"operation":"groupby"},"notebook":{"aggregations":[],"operation":"groupby"},"workspace":{"aggregations":["last"],"operation":null}}}},{"id":"organize","options":{"excludeByName":{"namespace":true,"workspace (last)":true},"indexByName":{"GPU Usage (last)":8,"GPU Used (last)":5,"Status":2,"Value #C (last)":7,"Value #D (last)":4,"Value #F (last)":9,"Value #G (last)":6,"namespace":3,"notebook":0,"workspace (last)":1},"renameByName":{"GPU Usage (last)":"GPU Usage","GPU Used (last)":"GPU Used","Status":"Status","Value #C (last)":"CPU Usage","Value #D (last)":"GPU Limit","Value #F (last)":"Memory Usage","Value #G (last)":"Mounted Volumes","namespace":"","notebook":"Notebook","workspace (last)":"Workspace"}}}],"type":"table"},{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","displayMode":"auto","filterable":false},"mappings":[{"from":"","id":1,"text":"1","to":"","type":1,"value":"True"},{"from":"","id":2,"text":"0","to":"","type":1,"value":"False"}],"noValue":"-","thresholds":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null},{"color":"yellow","value":0},{"color":"green","value":1}]}},"overrides":[{"matcher":{"id":"byName","options":"Status"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"Available","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"Bound","to":"","type":1,"value":"2"},{"from":"","id":3,"text":"Released","to":"","type":1,"value":"3"},{"from":"","id":4,"text":"Fail","to":"","type":1,"value":"0"}]},{"id":"custom.displayMode","value":"color-background"},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"rgb(255, 255, 255)","value":null},{"color":"red","value":0},{"color":"yellow","value":1},{"color":"green","value":2},{"color":"yellow","value":3}]}},{"id":"custom.width","value":200}]},{"matcher":{"id":"byName","options":"State"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"Attached","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"Detached","to":"","type":1,"value":"0"}]},{"id":"custom.displayMode","value":"color-background"},{"id":"custom.width","value":190}]},{"matcher":{"id":"byName","options":"Robustness"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"Healthy","to":"","type":1,"value":"1"},{"from":"","id":2,"text":"UnKnown","to":"","type":1,"value":"0"}]},{"id":"custom.displayMode","value":"color-background"},{"id":"custom.width","value":200}]},{"matcher":{"id":"byName","options":"Usage"},"properties":[{"id":"custom.displayMode","value":"basic"},{"id":"unit","value":"percentunit"},{"id":"thresholds","value":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.4},{"color":"orange","value":0.6},{"color":"red","value":0.8}]}}]}]},"gridPos":{"h":10,"w":24,"x":0,"y":29},"id":69,"options":{"frameIndex":1,"showHeader":true,"sortBy":[{"desc":false,"displayName":"persistentvolumeclaim"}]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"label_replace(label_replace(label_replace(label_replace(label_replace(label_replace(label_replace(label_replace(storage_volume_info, \"State\", \"1\", \"state\", \"attached\"), \"State\", \"0\", \"state\", \"detached\"), \"Status\", \"1\", \"pvStatus\", \"Available\"), \"Status\", \"2\", \"pvStatus\", \"Bound\"), \"Status\", \"3\", \"pvStatus\", \"Released\"), \"Status\", \"0\", \"pvStatus\", \"Fail\"), \"Robustness\", \"1\", \"robustness\", \"healthy\"), \"Robustness\", \"0\", \"robustness\", \"unknown\") * on (persistentvolume) group_left (claim_namespace) label_replace(kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"}, \"persistentvolumeclaim\", \"$1\", \"name\", \"(.+)\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"sum(label_replace(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"} and on (persistentvolume) kube_persistentvolume_info{job=\"gpu-metrics\", storageclass=~\"longhorn|longhorn-static\"}, \"persistentvolumeclaim\", \"$1\", \"name\", \"(.+)\")) by (persistentvolume, persistentvolumeclaim)\n/\nsum(kube_persistentvolume_capacity_bytes{job=\"gpu-metrics\"} * on (persistentvolume) group_left(namespace, persistentvolumeclaim) label_replace(kube_persistentvolumeclaim_info{job=\"gpu-metrics\", namespace=~\"$namespace\"}, \"persistentvolume\", \"$1\", \"volumename\", \"(.+)\")) by (persistentvolume, persistentvolumeclaim)","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"B"}],"title":"Volume Status","transformations":[{"id":"merge","options":{}},{"id":"groupBy","options":{"fields":{"Robustness":{"aggregations":[],"operation":"groupby"},"State":{"aggregations":[],"operation":"groupby"},"Status":{"aggregations":[],"operation":"groupby"},"Value #B":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Value #C":{"aggregations":["lastNotNull"],"operation":"aggregate"},"persistentvolume":{"aggregations":[],"operation":"groupby"},"persistentvolumeclaim":{"aggregations":[],"operation":"groupby"}}}},{"id":"filterByValue","options":{"filters":[{"config":{"id":"isNull","options":{}},"fieldName":"Value #B (lastNotNull)"}],"match":"any","type":"exclude"}},{"id":"organize","options":{"excludeByName":{"Value #B (lastNotNull)":false,"Value #C (lastNotNull)":false,"persistentvolume":true},"indexByName":{"Robustness":4,"State":3,"Status":2,"Value #B (lastNotNull)":5,"persistentvolume":0,"persistentvolumeclaim":1},"renameByName":{"Value #B (lastNotNull)":"Usage","persistentvolumeclaim":"Volume"}}},{"id":"sortBy","options":{"fields":{},"sort":[{"field":"Volume"}]}}],"type":"table"}],"refresh":"5s","schemaVersion":27,"style":"dark","tags":[],"templating":{"list":[{"allValue":".+","current":{"selected":true,"text":["All"],"value":["$__all"]},"datasource":null,"definition":"label_values(kube_node_info{job=\"gpu-metrics\"}, node)","description":null,"error":null,"hide":2,"includeAll":true,"label":null,"multi":true,"name":"node","options":[],"query":{"query":"label_values(kube_node_info{job=\"gpu-metrics\"}, node)","refId":"StandardVariableQuery"},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":"'.*'","current":{"selected":true,"text":["All"],"value":["$__all"]},"datasource":"PostgreSQL","definition":"select name\nfrom haiqv_workspace","description":null,"error":null,"hide":0,"includeAll":true,"label":null,"multi":true,"name":"workspace","options":[],"query":"select name\nfrom haiqv_workspace","refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"selected":false,"text":"^.*$","value":"^.*$"},"datasource":"PostgreSQL","definition":"select concat('^', concat_ws('$|^', $workspace), '$')","description":null,"error":null,"hide":2,"includeAll":false,"label":null,"multi":false,"name":"workspace_regex","options":[{"selected":true,"text":"^.*$","value":"^.*$"}],"query":"select concat('^', concat_ws('$|^', $workspace), '$')","refresh":0,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"selected":false,"text":".*","value":".*"},"datasource":"PostgreSQL","definition":"select string_agg(t1.namespace, '|') as namespace\nfrom (\n\tselect distinct\n\tcase\n\twhen '$workspace_regex' = '^.*$' then '.*'\n\telse concat('ns-', id)\n\tend as namespace\n\tfrom haiqv_workspace\n\twhere name ~ '$workspace_regex'\n) as t1","description":null,"error":null,"hide":2,"includeAll":false,"label":null,"multi":false,"name":"namespace","options":[{"selected":true,"text":".*","value":".*"}],"query":"select string_agg(t1.namespace, '|') as namespace\nfrom (\n\tselect distinct\n\tcase\n\twhen '$workspace_regex' = '^.*$' then '.*'\n\telse concat('ns-', id)\n\tend as namespace\n\tfrom haiqv_workspace\n\twhere name ~ '$workspace_regex'\n) as t1","refresh":0,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"description":null,"error":null,"hide":2,"label":null,"name":"buffer_factor","query":"1.1","skipUrlSync":false,"type":"constant"}]},"time":{"from":"now-3h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","15s","20s","30s","1m","5m","15m","30m","1h","2h","1d"]},"timezone":"","title":"Workspace","uid":"4fIveV14k","version":1}
  workspace_card.json: |-
    {"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":false,"gnetId":null,"graphTooltip":0,"id":183,"iteration":1678082422508,"links":[],"panels":[{"datasource":null,"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"center","displayMode":"auto","filterable":false},"decimals":3,"mappings":[],"thresholds":{"mode":"percentage","steps":[{"color":"green","value":null},{"color":"yellow","value":40},{"color":"orange","value":60},{"color":"red","value":80}]},"unit":"percent"},"overrides":[{"matcher":{"id":"byName","options":"Usage"},"properties":[{"id":"custom.displayMode","value":"basic"}]},{"matcher":{"id":"byName","options":"Resource"},"properties":[{"id":"custom.width","value":84}]},{"matcher":{"id":"byName","options":"Usage"},"properties":[{"id":"mappings","value":[{"from":"","id":1,"text":"-","to":"","type":1,"value":"-1"}]}]}]},"gridPos":{"h":4,"w":7,"x":0,"y":0},"id":83,"options":{"showHeader":false,"sortBy":[]},"pluginVersion":"7.5.17","targets":[{"exemplar":true,"expr":"label_replace(sum(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\", container!~\"istio.*\", container=~\".+\"} OR clamp_max(absent(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_irate{namespace=~\"$namespace\",  container!~\"istio.*\", container=~\".+\"}), 0))\n / (sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"cpu\", type=\"hard\"} > 0) * 1/$buffer_factor) * 100, \"Resource\", \"CPU\", \"\", \"\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"A"},{"exemplar":true,"expr":"label_replace((((count(DCGM_FI_DEV_GPU_UTIL{namespace=~\"$namespace\"} > 0) or clamp_max(absent(DCGM_FI_DEV_GPU_UTIL{namespace=~\"$namespace\"} > 0), 0)) / sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.nvidia.com/gpu\", type=\"hard\"} > 0))) * 100 or clamp_max(absent(sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.nvidia.com/gpu\", type=\"hard\"} > 0)), -1), \"Resource\", \"GPU\", \"\", \"\")","format":"table","instant":true,"interval":"","legendFormat":"","refId":"B"},{"exemplar":true,"expr":"label_replace(sum(container_memory_working_set_bytes{namespace=~\"$namespace\", container!~\"istio.*\", service=\"kube-prometheus-stack-kubelet\"} OR clamp_max(absent(container_memory_working_set_bytes{namespace=~\"$namespace\", container!~\"istio.*\", service=\"kube-prometheus-stack-kubelet\"}), 0)) / (sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"memory\", type=\"hard\"} > 0) * 1/$buffer_factor) * 100, \"Resource\", \"Memory\", \"\", \"\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"C"},{"exemplar":true,"expr":"label_replace((sum(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"}) OR clamp_max(absent(label_replace(longhorn_volume_actual_size_bytes, \"persistentvolume\", \"$1\", \"volume\", \"(.+)\") * on(persistentvolume) group_left(name, claim_namespace) kube_persistentvolume_claim_ref{job=\"gpu-metrics\", claim_namespace=~\"$namespace\"}), 0)) / sum(kube_resourcequota{job=\"gpu-metrics\", namespace=~\"$namespace\", resource=\"requests.storage\", type=\"hard\"} > 0) * 100, \"Resource\", \"Storage\", \"\", \"\")","format":"table","hide":false,"instant":true,"interval":"","legendFormat":"","refId":"D"}],"timeFrom":null,"timeShift":null,"transformations":[{"id":"merge","options":{}},{"id":"calculateField","options":{"alias":"Usage","mode":"reduceRow","reduce":{"reducer":"sum"}}},{"id":"groupBy","options":{"fields":{"Resource":{"aggregations":[],"operation":"groupby"},"Total":{"aggregations":["lastNotNull"],"operation":"aggregate"},"Usage":{"aggregations":["lastNotNull"],"operation":"aggregate"},"resource":{"aggregations":[],"operation":"groupby"}}}},{"id":"organize","options":{"excludeByName":{},"indexByName":{},"renameByName":{"Resource":"","Usage (lastNotNull)":"Usage"}}}],"type":"table"}],"refresh":"5s","schemaVersion":27,"style":"dark","tags":[],"templating":{"list":[{"allValue":null,"current":{"selected":false,"text":"ns-31","value":"ns-31"},"datasource":"PostgreSQL","definition":"select concat('ns-', id) as namespace\nfrom haiqv_workspace","description":null,"error":null,"hide":0,"includeAll":false,"label":null,"multi":false,"name":"namespace","options":[],"query":"select concat('ns-', id) as namespace\nfrom haiqv_workspace","refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"description":null,"error":null,"hide":2,"label":null,"name":"buffer_factor","query":"1.1","skipUrlSync":false,"type":"constant"}]},"time":{"from":"now-1h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"]},"timezone":"","title":"Workspace Card","uid":"fenc64J4k","version":1}

